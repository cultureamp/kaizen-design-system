import{c as Y,g as Ue,r as E,R as h}from"./index-CTjT7uj6.js";import{c as pe}from"./index-CCQ3W5xA.js";import{L as Ot}from"./Label-DlmzItqQ.js";import{l as oe,a as M,r as ve,S as ie,R as Bt,T as se,b as W,j as Ge,A as Ie,d as ee,F as H,e as Oe,f as Q,g as Qe,h as Be,P as le,i as Xe,M as $t,k as jt,w as $e,m as qt,s as zt,n as Dt,o as Ft,u as Vt,E as Nt,N as Wt}from"./useRichTextEditor-BOueCohL.js";import{D as Kt,I as Ht,A as Ut}from"./IncreaseIndentIcon-pGkYMmfx.js";import{B as Gt}from"./BoldIcon-BoDzys8O.js";import{I as Qt,U as Xt,B as Jt,N as Yt}from"./UnderlineIcon-C1wYI3bX.js";import{T as Zt,a as en}from"./ToolbarSection-DJiy3mWF.js";import{T as tn}from"./ToggleIconButton-DNSnfJQm.js";import{a as nn}from"./client-C7R75yIL.js";import{E as rn}from"./EditIcon-r0BJhC_f.js";import{E as on}from"./ExternalLinkIcon-D-unubvU.js";import{R as sn}from"./RemoveLinkIcon-D9z3k6B4.js";import{T as ln}from"./Text-D2gQH1xL.js";import{r as an}from"./index-9r8iugjR.js";import{u as un}from"./Popover-BcT7iVVN.js";import{L as fn}from"./LinkModal-DKIlHPDl.js";import{I as cn}from"./InlineNotification-CD7nmnbO.js";import{F as je}from"./FieldMessage-D8OmrYjz.js";const _e=(e,t)=>e.selection.empty?!1:(t&&t(e.tr.deleteSelection().scrollIntoView()),!0);function Je(e,t){let{$cursor:n}=e.selection;return!n||(t?!t.endOfTextblock("backward",e):n.parentOffset>0)?null:n}const Ye=(e,t,n)=>{let r=Je(e,n);if(!r)return!1;let o=Ee(r);if(!o){let s=r.blockRange(),l=s&&oe(s);return l==null?!1:(t&&t(e.tr.lift(s,l).scrollIntoView()),!0)}let i=o.nodeBefore;if(ft(e,o,t,-1))return!0;if(r.parent.content.size==0&&(N(i,"end")||M.isSelectable(i)))for(let s=r.depth;;s--){let l=ve(e.doc,r.before(s),r.after(s),Q.empty);if(l&&l.slice.size<l.to-l.from){if(t){let a=e.tr.step(l);a.setSelection(N(i,"end")?ie.findFrom(a.doc.resolve(a.mapping.map(o.pos,-1)),-1):M.create(a.doc,o.pos-i.nodeSize)),t(a.scrollIntoView())}return!0}if(s==1||r.node(s-1).childCount>1)break}return i.isAtom&&o.depth==r.depth-1?(t&&t(e.tr.delete(o.pos-i.nodeSize,o.pos).scrollIntoView()),!0):!1},pn=(e,t,n)=>{let r=Je(e,n);if(!r)return!1;let o=Ee(r);return o?Ze(e,o,t):!1},dn=(e,t,n)=>{let r=tt(e,n);if(!r)return!1;let o=Me(r);return o?Ze(e,o,t):!1};function Ze(e,t,n){let r=t.nodeBefore,o=r,i=t.pos-1;for(;!o.isTextblock;i--){if(o.type.spec.isolating)return!1;let c=o.lastChild;if(!c)return!1;o=c}let s=t.nodeAfter,l=s,a=t.pos+1;for(;!l.isTextblock;a++){if(l.type.spec.isolating)return!1;let c=l.firstChild;if(!c)return!1;l=c}let u=ve(e.doc,i,a,Q.empty);if(!u||u.from!=i||u instanceof Bt&&u.slice.size>=a-i)return!1;if(n){let c=e.tr.step(u);c.setSelection(se.create(c.doc,i)),n(c.scrollIntoView())}return!0}function N(e,t,n=!1){for(let r=e;r;r=t=="start"?r.firstChild:r.lastChild){if(r.isTextblock)return!0;if(n&&r.childCount!=1)return!1}return!1}const et=(e,t,n)=>{let{$head:r,empty:o}=e.selection,i=r;if(!o)return!1;if(r.parent.isTextblock){if(n?!n.endOfTextblock("backward",e):r.parentOffset>0)return!1;i=Ee(r)}let s=i&&i.nodeBefore;return!s||!M.isSelectable(s)?!1:(t&&t(e.tr.setSelection(M.create(e.doc,i.pos-s.nodeSize)).scrollIntoView()),!0)};function Ee(e){if(!e.parent.type.spec.isolating)for(let t=e.depth-1;t>=0;t--){if(e.index(t)>0)return e.doc.resolve(e.before(t+1));if(e.node(t).type.spec.isolating)break}return null}function tt(e,t){let{$cursor:n}=e.selection;return!n||(t?!t.endOfTextblock("forward",e):n.parentOffset<n.parent.content.size)?null:n}const nt=(e,t,n)=>{let r=tt(e,n);if(!r)return!1;let o=Me(r);if(!o)return!1;let i=o.nodeAfter;if(ft(e,o,t,1))return!0;if(r.parent.content.size==0&&(N(i,"start")||M.isSelectable(i))){let s=ve(e.doc,r.before(),r.after(),Q.empty);if(s&&s.slice.size<s.to-s.from){if(t){let l=e.tr.step(s);l.setSelection(N(i,"start")?ie.findFrom(l.doc.resolve(l.mapping.map(o.pos)),1):M.create(l.doc,l.mapping.map(o.pos))),t(l.scrollIntoView())}return!0}}return i.isAtom&&o.depth==r.depth-1?(t&&t(e.tr.delete(o.pos,o.pos+i.nodeSize).scrollIntoView()),!0):!1},rt=(e,t,n)=>{let{$head:r,empty:o}=e.selection,i=r;if(!o)return!1;if(r.parent.isTextblock){if(n?!n.endOfTextblock("forward",e):r.parentOffset<r.parent.content.size)return!1;i=Me(r)}let s=i&&i.nodeAfter;return!s||!M.isSelectable(s)?!1:(t&&t(e.tr.setSelection(M.create(e.doc,i.pos)).scrollIntoView()),!0)};function Me(e){if(!e.parent.type.spec.isolating)for(let t=e.depth-1;t>=0;t--){let n=e.node(t);if(e.index(t)+1<n.childCount)return e.doc.resolve(e.after(t+1));if(n.type.spec.isolating)break}return null}const mn=(e,t)=>{let n=e.selection,r=n instanceof M,o;if(r){if(n.node.isTextblock||!W(e.doc,n.from))return!1;o=n.from}else if(o=Ge(e.doc,n.from,-1),o==null)return!1;if(t){let i=e.tr.join(o);r&&i.setSelection(M.create(i.doc,o-e.doc.resolve(o).nodeBefore.nodeSize)),t(i.scrollIntoView())}return!0},hn=(e,t)=>{let n=e.selection,r;if(n instanceof M){if(n.node.isTextblock||!W(e.doc,n.to))return!1;r=n.to}else if(r=Ge(e.doc,n.to,1),r==null)return!1;return t&&t(e.tr.join(r).scrollIntoView()),!0},gn=(e,t)=>{let{$from:n,$to:r}=e.selection,o=n.blockRange(r),i=o&&oe(o);return i==null?!1:(t&&t(e.tr.lift(o,i).scrollIntoView()),!0)},ot=(e,t)=>{let{$head:n,$anchor:r}=e.selection;return!n.parent.type.spec.code||!n.sameParent(r)?!1:(t&&t(e.tr.insertText(`
`).scrollIntoView()),!0)};function xe(e){for(let t=0;t<e.edgeCount;t++){let{type:n}=e.edge(t);if(n.isTextblock&&!n.hasRequiredAttrs())return n}return null}const it=(e,t)=>{let{$head:n,$anchor:r}=e.selection;if(!n.parent.type.spec.code||!n.sameParent(r))return!1;let o=n.node(-1),i=n.indexAfter(-1),s=xe(o.contentMatchAt(i));if(!s||!o.canReplaceWith(i,i,s))return!1;if(t){let l=n.after(),a=e.tr.replaceWith(l,l,s.createAndFill());a.setSelection(ie.near(a.doc.resolve(l),1)),t(a.scrollIntoView())}return!0},st=(e,t)=>{let n=e.selection,{$from:r,$to:o}=n;if(n instanceof Ie||r.parent.inlineContent||o.parent.inlineContent)return!1;let i=xe(o.parent.contentMatchAt(o.indexAfter()));if(!i||!i.isTextblock)return!1;if(t){let s=(!r.parentOffset&&o.index()<o.parent.childCount?r:o).pos,l=e.tr.insert(s,i.createAndFill());l.setSelection(se.create(l.doc,s+1)),t(l.scrollIntoView())}return!0},lt=(e,t)=>{let{$cursor:n}=e.selection;if(!n||n.parent.content.size)return!1;if(n.depth>1&&n.after()!=n.end(-1)){let i=n.before();if(ee(e.doc,i))return t&&t(e.tr.split(i).scrollIntoView()),!0}let r=n.blockRange(),o=r&&oe(r);return o==null?!1:(t&&t(e.tr.lift(r,o).scrollIntoView()),!0)};function at(e){return(t,n)=>{let{$from:r,$to:o}=t.selection;if(t.selection instanceof M&&t.selection.node.isBlock)return!r.parentOffset||!ee(t.doc,r.pos)?!1:(n&&n(t.tr.split(r.pos).scrollIntoView()),!0);if(!r.parent.isBlock)return!1;if(n){let i=o.parentOffset==o.parent.content.size,s=t.tr;(t.selection instanceof se||t.selection instanceof Ie)&&s.deleteSelection();let l=r.depth==0?null:xe(r.node(-1).contentMatchAt(r.indexAfter(-1))),a=e&&e(o.parent,i,r),u=a?[a]:i&&l?[{type:l}]:void 0,c=ee(s.doc,s.mapping.map(r.pos),1,u);if(!u&&!c&&ee(s.doc,s.mapping.map(r.pos),1,l?[{type:l}]:void 0)&&(l&&(u=[{type:l}]),c=!0),c&&(s.split(s.mapping.map(r.pos),1,u),!i&&!r.parentOffset&&r.parent.type!=l)){let f=s.mapping.map(r.before()),p=s.doc.resolve(f);l&&r.node(-1).canReplaceWith(p.index(),p.index()+1,l)&&s.setNodeMarkup(s.mapping.map(r.before()),l)}n(s.scrollIntoView())}return!0}}const Te=at(),yn=(e,t)=>Te(e,t&&(n=>{let r=e.storedMarks||e.selection.$to.parentOffset&&e.selection.$from.marks();r&&n.ensureMarks(r),t(n)})),wn=(e,t)=>{let{$from:n,to:r}=e.selection,o,i=n.sharedDepth(r);return i==0?!1:(o=n.before(i),t&&t(e.tr.setSelection(M.create(e.doc,o))),!0)},ut=(e,t)=>(t&&t(e.tr.setSelection(new Ie(e.doc))),!0);function bn(e,t,n){let r=t.nodeBefore,o=t.nodeAfter,i=t.index();return!r||!o||!r.type.compatibleContent(o.type)?!1:!r.content.size&&t.parent.canReplace(i-1,i)?(n&&n(e.tr.delete(t.pos-r.nodeSize,t.pos).scrollIntoView()),!0):!t.parent.canReplace(i,i+1)||!(o.isTextblock||W(e.doc,t.pos))?!1:(n&&n(e.tr.clearIncompatible(t.pos,r.type,r.contentMatchAt(r.childCount)).join(t.pos).scrollIntoView()),!0)}function ft(e,t,n,r){let o=t.nodeBefore,i=t.nodeAfter,s,l,a=o.type.spec.isolating||i.type.spec.isolating;if(!a&&bn(e,t,n))return!0;let u=!a&&t.parent.canReplace(t.index(),t.index()+1);if(u&&(s=(l=o.contentMatchAt(o.childCount)).findWrapping(i.type))&&l.matchType(s[0]||i.type).validEnd){if(n){let d=t.pos+i.nodeSize,g=H.empty;for(let m=s.length-1;m>=0;m--)g=H.from(s[m].create(null,g));g=H.from(o.copy(g));let b=e.tr.step(new Oe(t.pos-1,d,t.pos,d,new Q(g,1,0),s.length,!0)),y=d+2*s.length;W(b.doc,y)&&b.join(y),n(b.scrollIntoView())}return!0}let c=i.type.spec.isolating||r>0&&a?null:ie.findFrom(t,1),f=c&&c.$from.blockRange(c.$to),p=f&&oe(f);if(p!=null&&p>=t.depth)return n&&n(e.tr.lift(f,p).scrollIntoView()),!0;if(u&&N(i,"start",!0)&&N(o,"end")){let d=o,g=[];for(;g.push(d),!d.isTextblock;)d=d.lastChild;let b=i,y=1;for(;!b.isTextblock;b=b.firstChild)y++;if(d.canReplace(d.childCount,d.childCount,b.content)){if(n){let m=H.empty;for(let _=g.length-1;_>=0;_--)m=H.from(g[_].copy(m));let w=e.tr.step(new Oe(t.pos-g.length,t.pos+i.nodeSize,t.pos+y,t.pos+i.nodeSize-y,new Q(m,g.length,0),0,!0));n(w.scrollIntoView())}return!0}}return!1}function ct(e){return function(t,n){let r=t.selection,o=e<0?r.$from:r.$to,i=o.depth;for(;o.node(i).isInline;){if(!i)return!1;i--}return o.node(i).isTextblock?(n&&n(t.tr.setSelection(se.create(t.doc,e<0?o.start(i):o.end(i)))),!0):!1}}const pt=ct(-1),dt=ct(1);function kn(e,t=null){return function(n,r){let{$from:o,$to:i}=n.selection,s=o.blockRange(i),l=s&&Qe(s,e,t);return l?(r&&r(n.tr.wrap(s,l).scrollIntoView()),!0):!1}}function vn(e,t=null){return function(n,r){let o=!1;for(let i=0;i<n.selection.ranges.length&&!o;i++){let{$from:{pos:s},$to:{pos:l}}=n.selection.ranges[i];n.doc.nodesBetween(s,l,(a,u)=>{if(o)return!1;if(!(!a.isTextblock||a.hasMarkup(e,t)))if(a.type==e)o=!0;else{let c=n.doc.resolve(u),f=c.index();o=c.parent.canReplaceWith(f,f+1,e)}})}if(!o)return!1;if(r){let i=n.tr;for(let s=0;s<n.selection.ranges.length;s++){let{$from:{pos:l},$to:{pos:a}}=n.selection.ranges[s];i.setBlockType(l,a,e,t)}r(i.scrollIntoView())}return!0}}function In(e,t,n,r){for(let o=0;o<t.length;o++){let{$from:i,$to:s}=t[o],l=i.depth==0?e.inlineContent&&e.type.allowsMarkType(n):!1;if(e.nodesBetween(i.pos,s.pos,(a,u)=>{if(l||!r&&a.isAtom&&a.isInline&&u>=i.pos&&u+a.nodeSize<=s.pos)return!1;l=a.inlineContent&&a.type.allowsMarkType(n)}),l)return!0}return!1}function _n(e){let t=[];for(let n=0;n<e.length;n++){let{$from:r,$to:o}=e[n];r.doc.nodesBetween(r.pos,o.pos,(i,s)=>{if(i.isAtom&&i.content.size&&i.isInline&&s>=r.pos&&s+i.nodeSize<=o.pos)return s+1>r.pos&&t.push(new Be(r,r.doc.resolve(s+1))),r=r.doc.resolve(s+1+i.content.size),!1}),r.pos<o.pos&&t.push(new Be(r,o))}return t}function be(e,t=null,n){let r=(n&&n.removeWhenPresent)!==!1,o=(n&&n.enterInlineAtoms)!==!1;return function(i,s){let{empty:l,$cursor:a,ranges:u}=i.selection;if(l&&!a||!In(i.doc,u,e,o))return!1;if(s)if(a)e.isInSet(i.storedMarks||a.marks())?s(i.tr.removeStoredMark(e)):s(i.tr.addStoredMark(e.create(t)));else{let c,f=i.tr;o||(u=_n(u)),r?c=!u.some(p=>i.doc.rangeHasMark(p.$from.pos,p.$to.pos,e)):c=!u.every(p=>{let d=!1;return f.doc.nodesBetween(p.$from.pos,p.$to.pos,(g,b,y)=>{if(d)return!1;d=!e.isInSet(g.marks)&&!!y&&y.type.allowsMarkType(e)&&!(g.isText&&/^\s*$/.test(g.textBetween(Math.max(0,p.$from.pos-b),Math.min(g.nodeSize,p.$to.pos-b))))}),!d});for(let p=0;p<u.length;p++){let{$from:d,$to:g}=u[p];if(!c)f.removeMark(d.pos,g.pos,e);else{let b=d.pos,y=g.pos,m=d.nodeAfter,w=g.nodeBefore,_=m&&m.isText?/^\s*/.exec(m.text)[0].length:0,$=w&&w.isText?/\s*$/.exec(w.text)[0].length:0;b+_<y&&(b+=_,y-=$),f.addMark(b,y,e.create(t))}}s(f.scrollIntoView())}return!0}}function En(e,t){return n=>{if(!n.isGeneric)return e(n);let r=[];for(let i=0;i<n.mapping.maps.length;i++){let s=n.mapping.maps[i];for(let l=0;l<r.length;l++)r[l]=s.map(r[l]);s.forEach((l,a,u,c)=>r.push(u,c))}let o=[];for(let i=0;i<r.length;i+=2){let s=r[i],l=r[i+1],a=n.doc.resolve(s),u=a.sharedDepth(l),c=a.node(u);for(let f=a.indexAfter(u),p=a.after(u+1);p<=l;++f){let d=c.maybeChild(f);if(!d)break;if(f&&o.indexOf(p)==-1){let g=c.child(f-1);g.type==d.type&&t(g,d)&&o.push(p)}p+=d.nodeSize}}o.sort((i,s)=>i-s);for(let i=o.length-1;i>=0;i--)W(n.doc,o[i])&&n.join(o[i]);e(n)}}function Mn(e,t){let n=Array.isArray(t)?r=>t.indexOf(r.type.name)>-1:t;return(r,o,i)=>e(r,o&&En(o,n),i)}function ae(...e){return function(t,n,r){for(let o=0;o<e.length;o++)if(e[o](t,n,r))return!0;return!1}}let de=ae(_e,Ye,et),qe=ae(_e,nt,rt);const C={Enter:ae(ot,st,lt,Te),"Mod-Enter":it,Backspace:de,"Mod-Backspace":de,"Shift-Backspace":de,Delete:qe,"Mod-Delete":qe,"Mod-a":ut},Se={"Ctrl-h":C.Backspace,"Alt-Backspace":C["Mod-Backspace"],"Ctrl-d":C.Delete,"Ctrl-Alt-Backspace":C["Mod-Delete"],"Alt-Delete":C["Mod-Delete"],"Alt-d":C["Mod-Delete"],"Ctrl-a":pt,"Ctrl-e":dt};for(let e in C)Se[e]=C[e];const xn=typeof navigator<"u"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):typeof os<"u"&&os.platform?os.platform()=="darwin":!1,mt=xn?Se:C,Tn=Object.freeze(Object.defineProperty({__proto__:null,autoJoin:Mn,baseKeymap:mt,chainCommands:ae,createParagraphNear:st,deleteSelection:_e,exitCode:it,joinBackward:Ye,joinDown:hn,joinForward:nt,joinTextblockBackward:pn,joinTextblockForward:dn,joinUp:mn,lift:gn,liftEmptyBlock:lt,macBaseKeymap:Se,newlineInCode:ot,pcBaseKeymap:C,selectAll:ut,selectNodeBackward:et,selectNodeForward:rt,selectParentNode:wn,selectTextblockEnd:dt,selectTextblockStart:pt,setBlockType:vn,splitBlock:Te,splitBlockAs:at,splitBlockKeepMarks:yn,toggleMark:be,wrapIn:kn},Symbol.toStringTag,{value:"Module"}));var D={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},ne={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},Sn=typeof navigator<"u"&&/Mac/.test(navigator.platform),Ln=typeof navigator<"u"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent);for(var I=0;I<10;I++)D[48+I]=D[96+I]=String(I);for(var I=1;I<=24;I++)D[I+111]="F"+I;for(var I=65;I<=90;I++)D[I]=String.fromCharCode(I+32),ne[I]=String.fromCharCode(I);for(var me in D)ne.hasOwnProperty(me)||(ne[me]=D[me]);function An(e){var t=Sn&&e.metaKey&&e.shiftKey&&!e.ctrlKey&&!e.altKey||Ln&&e.shiftKey&&e.key&&e.key.length==1||e.key=="Unidentified",n=!t&&e.key||(e.shiftKey?ne:D)[e.keyCode]||e.key||"Unidentified";return n=="Esc"&&(n="Escape"),n=="Del"&&(n="Delete"),n=="Left"&&(n="ArrowLeft"),n=="Up"&&(n="ArrowUp"),n=="Right"&&(n="ArrowRight"),n=="Down"&&(n="ArrowDown"),n}const Cn=typeof navigator<"u"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):!1;function Rn(e){let t=e.split(/-(?!$)/),n=t[t.length-1];n=="Space"&&(n=" ");let r,o,i,s;for(let l=0;l<t.length-1;l++){let a=t[l];if(/^(cmd|meta|m)$/i.test(a))s=!0;else if(/^a(lt)?$/i.test(a))r=!0;else if(/^(c|ctrl|control)$/i.test(a))o=!0;else if(/^s(hift)?$/i.test(a))i=!0;else if(/^mod$/i.test(a))Cn?s=!0:o=!0;else throw new Error("Unrecognized modifier name: "+a)}return r&&(n="Alt-"+n),o&&(n="Ctrl-"+n),s&&(n="Meta-"+n),i&&(n="Shift-"+n),n}function Pn(e){let t=Object.create(null);for(let n in e)t[Rn(n)]=e[n];return t}function he(e,t,n=!0){return t.altKey&&(e="Alt-"+e),t.ctrlKey&&(e="Ctrl-"+e),t.metaKey&&(e="Meta-"+e),n&&t.shiftKey&&(e="Shift-"+e),e}function ze(e){return new le({props:{handleKeyDown:On(e)}})}function On(e){let t=Pn(e);return function(n,r){let o=An(r),i,s=t[he(o,r)];if(s&&s(n.state,n.dispatch,n))return!0;if(o.length==1&&o!=" "){if(r.shiftKey){let l=t[he(o,r,!1)];if(l&&l(n.state,n.dispatch,n))return!0}if((r.shiftKey||r.altKey||r.metaKey||o.charCodeAt(0)>127)&&(i=D[r.keyCode])&&i!=o){let l=t[he(i,r)];if(l&&l(n.state,n.dispatch,n))return!0}}return!1}}var re=200,v=function(){};v.prototype.append=function(t){return t.length?(t=v.from(t),!this.length&&t||t.length<re&&this.leafAppend(t)||this.length<re&&t.leafPrepend(this)||this.appendInner(t)):this};v.prototype.prepend=function(t){return t.length?v.from(t).append(this):this};v.prototype.appendInner=function(t){return new Bn(this,t)};v.prototype.slice=function(t,n){return t===void 0&&(t=0),n===void 0&&(n=this.length),t>=n?v.empty:this.sliceInner(Math.max(0,t),Math.min(this.length,n))};v.prototype.get=function(t){if(!(t<0||t>=this.length))return this.getInner(t)};v.prototype.forEach=function(t,n,r){n===void 0&&(n=0),r===void 0&&(r=this.length),n<=r?this.forEachInner(t,n,r,0):this.forEachInvertedInner(t,n,r,0)};v.prototype.map=function(t,n,r){n===void 0&&(n=0),r===void 0&&(r=this.length);var o=[];return this.forEach(function(i,s){return o.push(t(i,s))},n,r),o};v.from=function(t){return t instanceof v?t:t&&t.length?new ht(t):v.empty};var ht=function(e){function t(r){e.call(this),this.values=r}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={length:{configurable:!0},depth:{configurable:!0}};return t.prototype.flatten=function(){return this.values},t.prototype.sliceInner=function(o,i){return o==0&&i==this.length?this:new t(this.values.slice(o,i))},t.prototype.getInner=function(o){return this.values[o]},t.prototype.forEachInner=function(o,i,s,l){for(var a=i;a<s;a++)if(o(this.values[a],l+a)===!1)return!1},t.prototype.forEachInvertedInner=function(o,i,s,l){for(var a=i-1;a>=s;a--)if(o(this.values[a],l+a)===!1)return!1},t.prototype.leafAppend=function(o){if(this.length+o.length<=re)return new t(this.values.concat(o.flatten()))},t.prototype.leafPrepend=function(o){if(this.length+o.length<=re)return new t(o.flatten().concat(this.values))},n.length.get=function(){return this.values.length},n.depth.get=function(){return 0},Object.defineProperties(t.prototype,n),t}(v);v.empty=new ht([]);var Bn=function(e){function t(n,r){e.call(this),this.left=n,this.right=r,this.length=n.length+r.length,this.depth=Math.max(n.depth,r.depth)+1}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.flatten=function(){return this.left.flatten().concat(this.right.flatten())},t.prototype.getInner=function(r){return r<this.left.length?this.left.get(r):this.right.get(r-this.left.length)},t.prototype.forEachInner=function(r,o,i,s){var l=this.left.length;if(o<l&&this.left.forEachInner(r,o,Math.min(i,l),s)===!1||i>l&&this.right.forEachInner(r,Math.max(o-l,0),Math.min(this.length,i)-l,s+l)===!1)return!1},t.prototype.forEachInvertedInner=function(r,o,i,s){var l=this.left.length;if(o>l&&this.right.forEachInvertedInner(r,o-l,Math.max(i,l)-l,s+l)===!1||i<l&&this.left.forEachInvertedInner(r,Math.min(o,l),i,s)===!1)return!1},t.prototype.sliceInner=function(r,o){if(r==0&&o==this.length)return this;var i=this.left.length;return o<=i?this.left.slice(r,o):r>=i?this.right.slice(r-i,o-i):this.left.slice(r,i).append(this.right.slice(0,o-i))},t.prototype.leafAppend=function(r){var o=this.right.leafAppend(r);if(o)return new t(this.left,o)},t.prototype.leafPrepend=function(r){var o=this.left.leafPrepend(r);if(o)return new t(o,this.right)},t.prototype.appendInner=function(r){return this.left.depth>=Math.max(this.right.depth,r.depth)+1?new t(this.left,new t(this.right,r)):new t(this,r)},t}(v);const $n=500;class T{constructor(t,n){this.items=t,this.eventCount=n}popEvent(t,n){if(this.eventCount==0)return null;let r=this.items.length;for(;;r--)if(this.items.get(r-1).selection){--r;break}let o,i;n&&(o=this.remapping(r,this.items.length),i=o.maps.length);let s=t.tr,l,a,u=[],c=[];return this.items.forEach((f,p)=>{if(!f.step){o||(o=this.remapping(r,p+1),i=o.maps.length),i--,c.push(f);return}if(o){c.push(new A(f.map));let d=f.step.map(o.slice(i)),g;d&&s.maybeStep(d).doc&&(g=s.mapping.maps[s.mapping.maps.length-1],u.push(new A(g,void 0,void 0,u.length+c.length))),i--,g&&o.appendMap(g,i)}else s.maybeStep(f.step);if(f.selection)return l=o?f.selection.map(o.slice(i)):f.selection,a=new T(this.items.slice(0,r).append(c.reverse().concat(u)),this.eventCount-1),!1},this.items.length,0),{remaining:a,transform:s,selection:l}}addTransform(t,n,r,o){let i=[],s=this.eventCount,l=this.items,a=!o&&l.length?l.get(l.length-1):null;for(let c=0;c<t.steps.length;c++){let f=t.steps[c].invert(t.docs[c]),p=new A(t.mapping.maps[c],f,n),d;(d=a&&a.merge(p))&&(p=d,c?i.pop():l=l.slice(0,l.length-1)),i.push(p),n&&(s++,n=void 0),o||(a=p)}let u=s-r.depth;return u>qn&&(l=jn(l,u),s-=u),new T(l.append(i),s)}remapping(t,n){let r=new $t;return this.items.forEach((o,i)=>{let s=o.mirrorOffset!=null&&i-o.mirrorOffset>=t?r.maps.length-o.mirrorOffset:void 0;r.appendMap(o.map,s)},t,n),r}addMaps(t){return this.eventCount==0?this:new T(this.items.append(t.map(n=>new A(n))),this.eventCount)}rebased(t,n){if(!this.eventCount)return this;let r=[],o=Math.max(0,this.items.length-n),i=t.mapping,s=t.steps.length,l=this.eventCount;this.items.forEach(p=>{p.selection&&l--},o);let a=n;this.items.forEach(p=>{let d=i.getMirror(--a);if(d==null)return;s=Math.min(s,d);let g=i.maps[d];if(p.step){let b=t.steps[d].invert(t.docs[d]),y=p.selection&&p.selection.map(i.slice(a+1,d));y&&l++,r.push(new A(g,b,y))}else r.push(new A(g))},o);let u=[];for(let p=n;p<s;p++)u.push(new A(i.maps[p]));let c=this.items.slice(0,o).append(u).append(r),f=new T(c,l);return f.emptyItemCount()>$n&&(f=f.compress(this.items.length-r.length)),f}emptyItemCount(){let t=0;return this.items.forEach(n=>{n.step||t++}),t}compress(t=this.items.length){let n=this.remapping(0,t),r=n.maps.length,o=[],i=0;return this.items.forEach((s,l)=>{if(l>=t)o.push(s),s.selection&&i++;else if(s.step){let a=s.step.map(n.slice(r)),u=a&&a.getMap();if(r--,u&&n.appendMap(u,r),a){let c=s.selection&&s.selection.map(n.slice(r));c&&i++;let f=new A(u.invert(),a,c),p,d=o.length-1;(p=o.length&&o[d].merge(f))?o[d]=p:o.push(f)}}else s.map&&r--},this.items.length,0),new T(v.from(o.reverse()),i)}}T.empty=new T(v.empty,0);function jn(e,t){let n;return e.forEach((r,o)=>{if(r.selection&&t--==0)return n=o,!1}),e.slice(n)}class A{constructor(t,n,r,o){this.map=t,this.step=n,this.selection=r,this.mirrorOffset=o}merge(t){if(this.step&&t.step&&!t.selection){let n=t.step.merge(this.step);if(n)return new A(n.getMap().invert(),n,this.selection)}}}class q{constructor(t,n,r,o,i){this.done=t,this.undone=n,this.prevRanges=r,this.prevTime=o,this.prevComposition=i}}const qn=20;function zn(e,t,n,r){let o=n.getMeta(P),i;if(o)return o.historyState;n.getMeta(gt)&&(e=new q(e.done,e.undone,null,0,-1));let s=n.getMeta("appendedTransaction");if(n.steps.length==0)return e;if(s&&s.getMeta(P))return s.getMeta(P).redo?new q(e.done.addTransform(n,void 0,r,te(t)),e.undone,De(n.mapping.maps),e.prevTime,e.prevComposition):new q(e.done,e.undone.addTransform(n,void 0,r,te(t)),null,e.prevTime,e.prevComposition);if(n.getMeta("addToHistory")!==!1&&!(s&&s.getMeta("addToHistory")===!1)){let l=n.getMeta("composition"),a=e.prevTime==0||!s&&e.prevComposition!=l&&(e.prevTime<(n.time||0)-r.newGroupDelay||!Dn(n,e.prevRanges)),u=s?ge(e.prevRanges,n.mapping):De(n.mapping.maps);return new q(e.done.addTransform(n,a?t.selection.getBookmark():void 0,r,te(t)),T.empty,u,n.time,l??e.prevComposition)}else return(i=n.getMeta("rebased"))?new q(e.done.rebased(n,i),e.undone.rebased(n,i),ge(e.prevRanges,n.mapping),e.prevTime,e.prevComposition):new q(e.done.addMaps(n.mapping.maps),e.undone.addMaps(n.mapping.maps),ge(e.prevRanges,n.mapping),e.prevTime,e.prevComposition)}function Dn(e,t){if(!t)return!1;if(!e.docChanged)return!0;let n=!1;return e.mapping.maps[0].forEach((r,o)=>{for(let i=0;i<t.length;i+=2)r<=t[i+1]&&o>=t[i]&&(n=!0)}),n}function De(e){let t=[];for(let n=e.length-1;n>=0&&t.length==0;n--)e[n].forEach((r,o,i,s)=>t.push(i,s));return t}function ge(e,t){if(!e)return null;let n=[];for(let r=0;r<e.length;r+=2){let o=t.map(e[r],1),i=t.map(e[r+1],-1);o<=i&&n.push(o,i)}return n}function Fn(e,t,n){let r=te(t),o=P.get(t).spec.config,i=(n?e.undone:e.done).popEvent(t,r);if(!i)return null;let s=i.selection.resolve(i.transform.doc),l=(n?e.done:e.undone).addTransform(i.transform,t.selection.getBookmark(),o,r),a=new q(n?l:i.remaining,n?i.remaining:l,null,0,-1);return i.transform.setSelection(s).setMeta(P,{redo:n,historyState:a})}let ye=!1,Fe=null;function te(e){let t=e.plugins;if(Fe!=t){ye=!1,Fe=t;for(let n=0;n<t.length;n++)if(t[n].spec.historyPreserveItems){ye=!0;break}}return ye}function Vn(e){return e.setMeta(gt,!0)}const P=new Xe("history"),gt=new Xe("closeHistory");function yt(e={}){return e={depth:e.depth||100,newGroupDelay:e.newGroupDelay||500},new le({key:P,state:{init(){return new q(T.empty,T.empty,null,0,-1)},apply(t,n,r){return zn(n,r,t,e)}},config:e,props:{handleDOMEvents:{beforeinput(t,n){let r=n.inputType,o=r=="historyUndo"?wt:r=="historyRedo"?bt:null;return o?(n.preventDefault(),o(t.state,t.dispatch)):!1}}}})}function ue(e,t){return(n,r)=>{let o=P.getState(n);if(!o||(e?o.undone:o.done).eventCount==0)return!1;if(r){let i=Fn(o,n,e);i&&r(t?i.scrollIntoView():i)}return!0}}const wt=ue(!1,!0),bt=ue(!0,!0),Nn=ue(!1,!1),Wn=ue(!0,!1);function Kn(e){let t=P.getState(e);return t?t.done.eventCount:0}function Hn(e){let t=P.getState(e);return t?t.undone.eventCount:0}const Un=Object.freeze(Object.defineProperty({__proto__:null,closeHistory:Vn,history:yt,redo:bt,redoDepth:Hn,redoNoScroll:Wn,undo:wt,undoDepth:Kn,undoNoScroll:Nn},Symbol.toStringTag,{value:"Module"}));class B{constructor(t,n,r={}){this.match=t,this.match=t,this.handler=typeof n=="string"?Gn(n):n,this.undoable=r.undoable!==!1,this.inCode=r.inCode||!1}}function Gn(e){return function(t,n,r,o){let i=e;if(n[1]){let s=n[0].lastIndexOf(n[1]);i+=n[0].slice(s+n[1].length),r+=s;let l=r-o;l>0&&(i=n[0].slice(s-l,s)+i,r=o)}return t.tr.insertText(i,r,o)}}const Qn=500;function Xn({rules:e}){let t=new le({state:{init(){return null},apply(n,r){let o=n.getMeta(this);return o||(n.selectionSet||n.docChanged?null:r)}},props:{handleTextInput(n,r,o,i){return Ve(n,r,o,i,e,t)},handleDOMEvents:{compositionend:n=>{setTimeout(()=>{let{$cursor:r}=n.state.selection;r&&Ve(n,r.pos,r.pos,"",e,t)})}}},isInputRules:!0});return t}function Ve(e,t,n,r,o,i){if(e.composing)return!1;let s=e.state,l=s.doc.resolve(t),a=l.parent.textBetween(Math.max(0,l.parentOffset-Qn),l.parentOffset,null,"￼")+r;for(let u=0;u<o.length;u++){let c=o[u];if(l.parent.type.spec.code){if(!c.inCode)continue}else if(c.inCode==="only")continue;let f=c.match.exec(a),p=f&&c.handler(s,f,t-(f[0].length-r.length),n);if(p)return c.undoable&&p.setMeta(i,{transform:p,from:t,to:n,text:r}),e.dispatch(p),!0}return!1}const Jn=(e,t)=>{let n=e.plugins;for(let r=0;r<n.length;r++){let o=n[r],i;if(o.spec.isInputRules&&(i=o.getState(e))){if(t){let s=e.tr,l=i.transform;for(let a=l.steps.length-1;a>=0;a--)s.step(l.steps[a].invert(l.docs[a]));if(i.text){let a=s.doc.resolve(i.from).marks();s.replaceWith(i.from,i.to,e.schema.text(i.text,a))}else s.delete(i.from,i.to);t(s)}return!0}}return!1},Yn=new B(/--$/,"—"),Zn=new B(/\.\.\.$/,"…"),kt=new B(/(?:^|[\s\{\[\(\<'"\u2018\u201C])(")$/,"“"),vt=new B(/"$/,"”"),It=new B(/(?:^|[\s\{\[\(\<'"\u2018\u201C])(')$/,"‘"),_t=new B(/'$/,"’"),er=[kt,vt,It,_t];function Le(e,t,n=null,r){return new B(e,(o,i,s,l)=>{let a=n instanceof Function?n(i):n,u=o.tr.delete(s,l),c=u.doc.resolve(s),f=c.blockRange(),p=f&&Qe(f,t,a);if(!p)return null;u.wrap(f,p);let d=u.doc.resolve(s-1).nodeBefore;return d&&d.type==t&&W(u.doc,s-1)&&(!r||r(i,d))&&u.join(s-1),u})}function tr(e,t,n=null){return new B(e,(r,o,i,s)=>{let l=r.doc.resolve(i),a=n instanceof Function?n(o):n;return l.node(-1).canReplaceWith(l.index(-1),l.indexAfter(-1),t)?r.tr.delete(i,s).setBlockType(i,i,t,a):null})}const Et=Object.freeze(Object.defineProperty({__proto__:null,InputRule:B,closeDoubleQuote:vt,closeSingleQuote:_t,ellipsis:Zn,emDash:Yn,inputRules:Xn,openDoubleQuote:kt,openSingleQuote:It,smartQuotes:er,textblockTypeInputRule:tr,undoInputRule:Jn,wrappingInputRule:Le},Symbol.toStringTag,{value:"Module"}));var nr="Expected a function",Ne=NaN,rr="[object Symbol]",or=/^\s+|\s+$/g,ir=/^[-+]0x[0-9a-f]+$/i,sr=/^0b[01]+$/i,lr=/^0o[0-7]+$/i,ar=parseInt,ur=typeof Y=="object"&&Y&&Y.Object===Object&&Y,fr=typeof self=="object"&&self&&self.Object===Object&&self,cr=ur||fr||Function("return this")(),pr=Object.prototype,dr=pr.toString,mr=Math.max,hr=Math.min,we=function(){return cr.Date.now()};function gr(e,t,n){var r,o,i,s,l,a,u=0,c=!1,f=!1,p=!0;if(typeof e!="function")throw new TypeError(nr);t=We(t)||0,ke(n)&&(c=!!n.leading,f="maxWait"in n,i=f?mr(We(n.maxWait)||0,t):i,p="trailing"in n?!!n.trailing:p);function d(k){var L=r,R=o;return r=o=void 0,u=k,s=e.apply(R,L),s}function g(k){return u=k,l=setTimeout(m,t),c?d(k):s}function b(k){var L=k-a,R=k-u,J=t-L;return f?hr(J,i-R):J}function y(k){var L=k-a,R=k-u;return a===void 0||L>=t||L<0||f&&R>=i}function m(){var k=we();if(y(k))return w(k);l=setTimeout(m,b(k))}function w(k){return l=void 0,p&&r?d(k):(r=o=void 0,s)}function _(){l!==void 0&&clearTimeout(l),u=0,r=a=o=l=void 0}function $(){return l===void 0?s:w(we())}function j(){var k=we(),L=y(k);if(r=arguments,o=this,a=k,L){if(l===void 0)return g(a);if(f)return l=setTimeout(m,t),d(a)}return l===void 0&&(l=setTimeout(m,t)),s}return j.cancel=_,j.flush=$,j}function ke(e){var t=typeof e;return!!e&&(t=="object"||t=="function")}function yr(e){return!!e&&typeof e=="object"}function wr(e){return typeof e=="symbol"||yr(e)&&dr.call(e)==rr}function We(e){if(typeof e=="number")return e;if(wr(e))return Ne;if(ke(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=ke(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=e.replace(or,"");var n=sr.test(e);return n||lr.test(e)?ar(e.slice(2),n?2:8):ir.test(e)?Ne:+e}var br=gr;const Mt=Ue(br);var kr=(e,t)=>Array.isArray(e)&&e.indexOf(t.type)>-1||t.type===e,vr=(e,t)=>{for(let n=e.depth;n>0;n--){const r=e.node(n);if(t(r))return{pos:n>0?e.before(n):0,start:e.start(n),depth:n,node:r}}},Ir=(e,t)=>vr(e,n=>kr(t,n)),_r=function(t,n,r){var o,i=t.length;if(!(n>=i||r===0)){r=n+r>i?i-n:r;var s=i-r;for(o=n;o<s;++o)t[o]=t[o+r];t.length=s}};O.notEqual=Mr;O.notOk=xr;O.equal=Er;O.ok=O;var Ae=O;function Er(e,t,n){O(e==t,n)}function Mr(e,t,n){O(e!=t,n)}function xr(e,t){O(!e,t)}function O(e,t){if(!e)throw new Error(t||"AssertionError")}var Tr=Ae,Sr=typeof window<"u";function Lr(){var e;return Sr?(window._nanoScheduler||(window._nanoScheduler=new X(!0)),e=window._nanoScheduler):e=new X,e}function X(e){this.hasWindow=e,this.hasIdle=this.hasWindow&&window.requestIdleCallback,this.method=this.hasIdle?window.requestIdleCallback.bind(window):this.setTimeout,this.scheduled=!1,this.queue=[]}X.prototype.push=function(e){Tr.equal(typeof e,"function","nanoscheduler.push: cb should be type function"),this.queue.push(e),this.schedule()};X.prototype.schedule=function(){if(!this.scheduled){this.scheduled=!0;var e=this;this.method(function(t){for(var n;e.queue.length&&t.timeRemaining()>0;)n=e.queue.shift(),n(t);e.scheduled=!1,e.queue.length&&e.schedule()})}};X.prototype.setTimeout=function(e){setTimeout(e,0,{timeRemaining:function(){return 1}})};var Ar=Lr,xt=Ar(),Cr=Ae,z;fe.disabled=!0;try{z=window.performance,fe.disabled=window.localStorage.DISABLE_NANOTIMING==="true"||!z.mark}catch{}var Rr=fe;function fe(e){if(Cr.equal(typeof e,"string","nanotiming: name should be type string"),fe.disabled)return Pr;var t=(z.now()*1e4).toFixed()%Number.MAX_SAFE_INTEGER,n="start-"+t+"-"+e;z.mark(n);function r(o){var i="end-"+t+"-"+e;z.mark(i),xt.push(function(){var s=null;try{var l=e+" ["+t+"]";z.measure(l,n,i),z.clearMarks(n),z.clearMarks(i)}catch(a){s=a}o&&o(s,e)})}return r.uuid=t,r}function Pr(e){e&&xt.push(function(){e(new Error("nanotiming: performance API unavailable"))})}var Or=_r,Br=Rr,S=Ae,$r=x;function x(e){if(!(this instanceof x))return new x(e);this._name=e||"nanobus",this._starListeners=[],this._listeners={}}x.prototype.emit=function(e){S.ok(typeof e=="string"||typeof e=="symbol","nanobus.emit: eventName should be type string or symbol");for(var t=[],n=1,r=arguments.length;n<r;n++)t.push(arguments[n]);var o=Br(this._name+"('"+e.toString()+"')"),i=this._listeners[e];return i&&i.length>0&&this._emit(this._listeners[e],t),this._starListeners.length>0&&this._emit(this._starListeners,e,t,o.uuid),o(),this};x.prototype.on=x.prototype.addListener=function(e,t){return S.ok(typeof e=="string"||typeof e=="symbol","nanobus.on: eventName should be type string or symbol"),S.equal(typeof t,"function","nanobus.on: listener should be type function"),e==="*"?this._starListeners.push(t):(this._listeners[e]||(this._listeners[e]=[]),this._listeners[e].push(t)),this};x.prototype.prependListener=function(e,t){return S.ok(typeof e=="string"||typeof e=="symbol","nanobus.prependListener: eventName should be type string or symbol"),S.equal(typeof t,"function","nanobus.prependListener: listener should be type function"),e==="*"?this._starListeners.unshift(t):(this._listeners[e]||(this._listeners[e]=[]),this._listeners[e].unshift(t)),this};x.prototype.once=function(e,t){S.ok(typeof e=="string"||typeof e=="symbol","nanobus.once: eventName should be type string or symbol"),S.equal(typeof t,"function","nanobus.once: listener should be type function");var n=this;this.on(e,r);function r(){t.apply(n,arguments),n.removeListener(e,r)}return this};x.prototype.prependOnceListener=function(e,t){S.ok(typeof e=="string"||typeof e=="symbol","nanobus.prependOnceListener: eventName should be type string or symbol"),S.equal(typeof t,"function","nanobus.prependOnceListener: listener should be type function");var n=this;this.prependListener(e,r);function r(){t.apply(n,arguments),n.removeListener(e,r)}return this};x.prototype.removeListener=function(e,t){if(S.ok(typeof e=="string"||typeof e=="symbol","nanobus.removeListener: eventName should be type string or symbol"),S.equal(typeof t,"function","nanobus.removeListener: listener should be type function"),e==="*")return this._starListeners=this._starListeners.slice(),n(this._starListeners,t);return typeof this._listeners[e]<"u"&&(this._listeners[e]=this._listeners[e].slice()),n(this._listeners[e],t);function n(r,o){if(r){var i=r.indexOf(o);if(i!==-1)return Or(r,i,1),!0}}};x.prototype.removeAllListeners=function(e){return e?e==="*"?this._starListeners=[]:this._listeners[e]=[]:(this._starListeners=[],this._listeners={}),this};x.prototype.listeners=function(e){var t=e!=="*"?this._listeners[e]:this._starListeners,n=[];if(t)for(var r=t.length,o=0;o<r;o++)n.push(t[o]);return n};x.prototype._emit=function(e,t,n,r){if(!(typeof e>"u")&&e.length!==0){n===void 0&&(n=t,t=null),t&&(r!==void 0?n=[t].concat(n,r):n=[t].concat(n));for(var o=e.length,i=0;i<o;i++){var s=e[i];s.apply(s,n)}}};const jr=Ue($r),qr=e=>Le(/^(\d+)\.\s$/,e,t=>({order:+t[1]}),(t,n)=>n.childCount+n.attrs.order==+t[1]),zr=e=>Le(/^\s*([-+*])\s$/,e),Dr=(e,t)=>{const{from:n,to:r}=e.selection;let o=[];e.doc.nodesBetween(n,r,s=>{o=[...o,...s.marks]});const i=o.find(s=>s.type.name===t.name);return i?i.attrs:{}},ce=(e=null,t=null)=>{if(!e||!t)return null;const n=e.parent.childAfter(e.parentOffset);if(!n.node)return null;const r=n.node.marks.find(a=>a.type===t);if(!r)return null;let o=e.index(),i=e.start()+n.offset,s=o+1,l=i+n.node.nodeSize;for(;o>0&&r.isInSet(e.parent.child(o-1).marks);)o-=1,i-=e.parent.child(o).nodeSize;for(;s<e.parent.childCount&&r.isInSet(e.parent.child(s).marks);)l+=e.parent.child(s).nodeSize,s+=1;return{from:i,to:l}},Ke=(e,t,n)=>{const r=Ir(e.selection.$from,n);return(r==null?void 0:r.node.type)===t},G=(e,t)=>{const{from:n,$from:r,to:o,empty:i}=e.selection;return i?!!t.isInSet(e.storedMarks||r.marks()):!!e.doc.rangeHasMark(n,o,t)},Fr=(e,t)=>{if(!G(e,t))return!1;const{selection:n}=e,{$from:r}=n,o=ce(r,t);return!!o&&o.from<=n.from&&o.to>=n.to},Vr=(e,t={toExtent:!1})=>(n,r)=>{const{tr:o,selection:i,doc:s}=n;let{from:l,to:a}=i;const{$from:u}=i;if(!r)return!1;if(i.empty)r(o.removeStoredMark(e));else{if(t.range||t.toExtent){const f=t.range||ce(u,e);f&&(l=f.from,a=f.to)}s.rangeHasMark(l,a,e)&&o.removeMark(l,a,e),r(o)}return!0},Nr=(e,t,n={toExtent:!1})=>(r,o)=>{if(!o)return!1;const{tr:i,selection:s,doc:l}=r;let{from:a,to:u}=s;const{$from:c,empty:f}=s;if(f||n.toExtent){const d=ce(c,e);d&&(a=d.from,u=d.to)}return l.rangeHasMark(a,u,e)&&i.removeMark(a,u,e),i.addMark(a,u,e.create(t)),o(i),!0},Wr=(e,t)=>(n,r)=>{if(!r)return!1;const o=0,i=n.doc.content.size,{tr:s}=n,l=[];let a=0;return s.doc.nodesBetween(o,i,(u,c)=>{a++;const f=e.isInSet(u.marks);f&&!t(f.attrs)&&l.push({style:f,from:Math.max(c,o),to:Math.min(c+u.nodeSize,i),step:a})}),l.forEach(u=>s.step(new jt(u.from,u.to,u.style))),r(s),!0},Ce=E.forwardRef(({top:e,left:t,height:n,width:r},o)=>{const[i,s]=E.useState(),[l,a]=E.useState();E.useEffect(()=>{a([window.scrollX,window.scrollY]),s(document.body)},[]);const u=E.useRef(Mt(()=>a([window.scrollX,window.scrollY]),15));if(E.useEffect(()=>{const p=u.current;return window.addEventListener("resize",p),()=>{window.removeEventListener("resize",p)}},[a,u]),l===void 0||i===void 0)return null;const[c,f]=l;return an.createPortal(h.createElement("div",{ref:o,style:{height:`${n}px`,left:`${t+c}px`,pointerEvents:"none",position:"absolute",top:`${e+f}px`,width:`${r}px`}}),i)});Ce.displayName="Positioner";Ce.__docgenInfo={description:"",methods:[],displayName:"Positioner"};const Kr="_popoverContent_ii0cp_3",Hr="_popoverLinkContainer_ii0cp_9",Ur="_popoverLink_ii0cp_9",Gr="_paragraphFlex_ii0cp_20",Qr="_popoverActions_ii0cp_24",U={popoverContent:Kr,popoverLinkContainer:Hr,popoverLink:Ur,paragraphFlex:Gr,popoverActions:Qr},Re=({href:e,onRemove:t,onEdit:n,selectionPosition:r})=>{const[o,i]=un();return h.createElement(h.Fragment,null,h.createElement(Ce,{ref:o,...r}),h.createElement(i,{size:"large"},h.createElement("div",{className:U.popoverContent},h.createElement(on,{role:"presentation"}),h.createElement("div",{className:U.popoverLinkContainer},h.createElement(ln,{variant:"body",tag:"div",classNameOverride:U.paragraphFlex},h.createElement("a",{className:U.popoverLink,href:e??void 0,target:"_blank",rel:"noopener noreferrer"},e))),h.createElement("div",{className:U.popoverActions},h.createElement(rn,{role:"img",onClick:n,"aria-label":"Edit link"})),h.createElement(sn,{role:"img",onClick:t,"aria-label":"Remove link"}))))};Re.displayName="LinkPopover";Re.__docgenInfo={description:"",methods:[],displayName:"LinkPopover",props:{href:{required:!1,tsType:{name:"string"},description:""},onRemove:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},onEdit:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},selectionPosition:{required:!0,tsType:{name:"signature",type:"object",raw:`{
  top: number
  left: number
  height: number
  width: number
}`,signature:{properties:[{key:"top",value:{name:"number",required:!0}},{key:"left",value:{name:"number",required:!0}},{key:"height",value:{name:"number",required:!0}},{key:"width",value:{name:"number",required:!0}}]}},description:""}}};const Pe=({attrs:e,removeMark:t,updateAttrs:n,selectionPosition:r,focusEditor:o})=>{var f;const[i,s]=E.useState(e.href!=null),[l,a]=E.useState(((f=e._metadata)==null?void 0:f.added)===!0),[u,c]=E.useState(e.href?e.href:void 0);return h.createElement(h.Fragment,null,i&&h.createElement(Re,{href:u,selectionPosition:r,onRemove:()=>{t(),o()},onEdit:()=>{s(!1),a(!0)}}),h.createElement(fn,{defaultHref:u,isOpen:l,onAfterLeave:o,onSubmit:p=>{c(p),n({href:p,_metadata:null}),a(!1)},onDismiss:()=>{a(!1),u?s(!0):t()}}))};Pe.displayName="LinkEditor";Pe.__docgenInfo={description:"",methods:[],displayName:"LinkEditor",props:{removeMark:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},updateAttrs:{required:!0,tsType:{name:"signature",type:"function",raw:"({ href }: LinkEditorAttrs) => void",signature:{arguments:[{type:{name:"signature",type:"object",raw:`{
  href: string | null
  _metadata: { [key: string]: unknown } | null
}`,signature:{properties:[{key:"href",value:{name:"union",raw:"string | null",elements:[{name:"string"},{name:"null"}],required:!0}},{key:"_metadata",value:{name:"union",raw:"{ [key: string]: unknown } | null",elements:[{name:"signature",type:"object",raw:"{ [key: string]: unknown }",signature:{properties:[{key:{name:"string"},value:{name:"unknown",required:!0}}]}},{name:"null"}],required:!0}}]}},name:""}],return:{name:"void"}}},description:""},attrs:{required:!0,tsType:{name:"signature",type:"object",raw:`{
  href: string | null
  _metadata: { [key: string]: unknown } | null
}`,signature:{properties:[{key:"href",value:{name:"union",raw:"string | null",elements:[{name:"string"},{name:"null"}],required:!0}},{key:"_metadata",value:{name:"union",raw:"{ [key: string]: unknown } | null",elements:[{name:"signature",type:"object",raw:"{ [key: string]: unknown }",signature:{properties:[{key:{name:"string"},value:{name:"unknown",required:!0}}]}},{name:"null"}],required:!0}}]}},description:""},selectionPosition:{required:!0,tsType:{name:"signature",type:"object",raw:`{
  top: number
  left: number
  height: number
  width: number
}`,signature:{properties:[{key:"top",value:{name:"number",required:!0}},{key:"left",value:{name:"number",required:!0}},{key:"height",value:{name:"number",required:!0}},{key:"width",value:{name:"number",required:!0}}]}},description:""},focusEditor:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""}}};const Xr=({emitter:e,componentProps:t,Component:n})=>{const[r,o]=E.useState(t);return E.useEffect(()=>{const i=s=>{o(s)};return e.addListener("update",i),()=>{e.removeListener("update",i)}},[e]),h.createElement(n,{...r})},Jr=(e,t,n)=>{const r=new jr,o=document.createElement("div");e.appendChild(o);const i=nn(o);i.render(h.createElement(Xr,{componentProps:n,Component:t,emitter:r}));function s(){i.unmount(),r.removeAllListeners("*")}function l(a){r.emit("update",a)}return{destroy:s,update:l}};class Yr{constructor(t,n,r,o){this.editorComponent=r,this.linkActive=i=>G(i,n),this.validateLinks=Wr(n,o),this.markType=n,this.tooltipTarget=null,this.update(t,null),this.onResize=Mt(()=>{this.update(t,null)},15)}update(t,n){const{state:r}=t;if(!(n&&n.doc.eq(r.doc)&&n.selection.eq(r.selection))){if(r.selection.empty||!this.linkActive(r)){this.destroyElement(t);return}this.tooltipTarget||this.createElement(t),this.updateElement(t)}}destroy(){var t;(t=this.tooltipTarget)==null||t.destroy(),window.removeEventListener("resize",this.onResize)}createElement(t){t.dom.parentElement&&(this.tooltipTarget=Jr(t.dom.parentElement,this.editorComponent,this.getEditorProps(t)),window.addEventListener("resize",this.onResize))}updateElement(t){var n;(n=this.tooltipTarget)==null||n.update(this.getEditorProps(t))}destroyElement(t){var n;t.dispatch(this.validateLinks),(n=this.tooltipTarget)==null||n.destroy(),this.tooltipTarget=null}getEditorProps(t){let n=null;const{selection:r}=t.state,o=Fr(t.state,this.markType),{$from:i}=r,s=ce(i,this.markType);let l,a;return!o&&s?(l=t.coordsAtPos(s.from),a=t.coordsAtPos(s.to)):(l=t.coordsAtPos(r.from),r.to===t.state.doc.content.size?a=t.coordsAtPos(r.to-1):a=t.coordsAtPos(r.to)),n={top:l.top,left:l.left,width:a.right-l.left,height:l.top-l.bottom},{removeMark:()=>{t.dispatch(Vr(this.markType,{toExtent:!0}))},updateAttrs:u=>{t.dispatch(Nr(this.markType,u,{toExtent:!0}))},attrs:Dr(t.state,this.markType),selectionPosition:n,focusEditor:()=>{t.focus()}}}}const Zr=e=>e==null?!1:e.href&&e.href!=="",eo=({markType:e,editorComponent:t=Pe,linkAttributeValidator:n=Zr})=>new le({view(r){return new Yr(r,e,t,n)}}),Tt=(...e)=>(t,n)=>{const r=i=>{t=t.apply(i),n&&n(i)},o=e.pop();for(const i of e)i(t,r);return o!==void 0&&o(t,n)},St=(e,t)=>{if(t){const{tr:n,schema:r}=e;return t(n.replaceSelectionWith(r.nodes.paragraph.create())),!0}return!1},Z=e=>(t,n)=>t.doc.content.size===0?Tt(St,be(e))(t,n):be(e)(t,n),He=e=>(t,n)=>t.doc.content.size===0?Tt(St,$e(e))(t,n):$e(e)(t,n),to=()=>(e,t)=>{var o;const{$from:n}=e.selection,r=(o=n.node(n.depth-1))==null?void 0:o.type;return qt(r)(e,t)},no=()=>(e,t)=>{var o;const{$from:n}=e.selection,r=(o=n.node(n.depth-1))==null?void 0:o.type;return zt(r)(e,t)},ro=e=>{var o;const{$from:t}=e.selection,n=(o=t.node(t.depth-1))==null?void 0:o.type;return!((n==null?void 0:n.name)==="listItem"||!1)},oo=e=>{var s;const{$from:t,$to:n}=e.selection,r=(s=t.node(t.depth-1))==null?void 0:s.type;if(!((r==null?void 0:r.name)==="listItem"||!1))return!0;const i=t.blockRange(n,l=>l.childCount>0&&l.firstChild.type===r);return!i||i.startIndex===0},io=e=>e.reduce((t,n)=>n!=null&&n.name?{...t,[n.name]:n.group||"ungrouped"}:t,{}),so=e=>{const n=Array.from(new Set(Object.values(e))).reduce((r,o)=>o==="ungrouped"?r:{...r,[o]:[]},{});return n.ungrouped=[],n},V=(e,t)=>t?e[t]??"ungrouped":"ungrouped",lo=e=>Object.values(e).filter(t=>t.length>0),ao=(e,t,n)=>{if(!n)return[];const r=io(n),o=so(r),i=[e.nodes.bulletList,e.nodes.orderedList];if(e.marks.strong){const s=e.marks.strong,l=V(r,"bold");o[l].push({isActive:G(t,s),action:Z(s),label:"Bold",icon:h.createElement(Gt,{role:"presentation"})})}if(e.marks.em){const s=e.marks.em,l=V(r,"italic");o[l].push({isActive:G(t,s),action:Z(s),label:"Italic",icon:h.createElement(Qt,{role:"presentation"})})}if(e.marks.underline){const s=e.marks.underline,l=V(r,"underline");o[l].push({isActive:G(t,s),action:Z(s),label:"Underline",icon:h.createElement(Xt,{role:"presentation"})})}if(e.nodes.bulletList){const s=e.nodes.bulletList,l=V(r,"bulletList");o[l].push({action:He(s),isActive:Ke(t,s,i),label:"Bullet List",icon:h.createElement(Jt,{role:"presentation"})})}if(e.nodes.orderedList){const s=e.nodes.orderedList,l=V(r,"orderedList");o[l].push({action:He(s),isActive:Ke(t,s,i),label:"Numbered List",icon:h.createElement(Yt,{role:"presentation"})})}if(e.nodes.orderedList||e.nodes.bulletList){const s=r.orderedList||r.bulletList||"ungrouped";o[s].push({action:to(),disabled:ro(t),isActive:!1,label:"Decrease indent",icon:h.createElement(Kt,{role:"presentation"})},{action:no(),disabled:oo(t),isActive:!1,label:"Increase indent",icon:h.createElement(Ht,{role:"presentation"})})}if(e.marks.link){const s=e.marks.link,l=V(r,"link");o[l].push({action:Z(s),disabled:t.selection.empty,isActive:!1,label:"Link",icon:h.createElement(Ut,{role:"presentation"})})}return lo(o)},uo=e=>{const{smartQuotes:t,ellipsis:n,emDash:r,inputRules:o}=Et,i=t.concat(n,r);return e.nodes.orderedList&&i.push(qr(e.nodes.orderedList)),e.nodes.bulletList&&i.push(zr(e.nodes.bulletList)),o({rules:i})},fo=e=>{const{redo:t,undo:n}=Un,{undoInputRule:r}=Et,{wrapInList:o,splitListItem:i,liftListItem:s,sinkListItem:l}=Dt,a=typeof navigator<"u"?/Mac/.test(navigator.platform):!1,{chainCommands:u,exitCode:c,joinDown:f,joinUp:p,lift:d,selectParentNode:g,setBlockType:b,toggleMark:y}=Tn,m={"Mod-z":n,"Shift-Mod-z":t,Backspace:r,"Alt-ArrowUp":p,"Alt-ArrowDown":f,"Mod-BracketLeft":d,Escape:g};if(a||(m["Mod-y"]=t),e.marks.strong){const w=e.marks.strong;m["Mod-b"]=y(w),m["Mod-B"]=y(w)}if(e.marks.em){const w=e.marks.em;m["Mod-i"]=y(w),m["Mod-I"]=y(w)}if(e.marks.underline){const w=e.marks.underline;m["Mod-u"]=y(w),m["Mod-U"]=y(w)}if(e.nodes.hardBreak){const w=e.nodes.hardBreak,_=u(c,($,j)=>(j&&j($.tr.replaceSelectionWith(w.create()).scrollIntoView()),!0));m["Mod-Enter"]=_,m["Shift-Enter"]=_,a&&(m["Ctrl-Enter"]=_)}if(e.nodes.paragraph&&(m["Shift-Ctrl-0"]=b(e.nodes.paragraph)),e.nodes.bulletList&&(m["Shift-Ctrl-8"]=o(e.nodes.bulletList)),e.nodes.orderedList&&(m["Shift-Ctrl-9"]=o(e.nodes.orderedList)),e.nodes.listItem){const w=e.nodes.listItem;m.Enter=i(w),m["Mod-["]=s(w),m["Mod-]"]=l(w)}return m},co="_editor_10hg4_9",po="_hasToolbar_10hg4_130",mo="_editorLabel_10hg4_135",ho="_editorWrapper_10hg4_141",go="_toolbar_10hg4_152",yo="_error_10hg4_155",wo="_caution_10hg4_163",bo="_rows1_10hg4_172",ko="_rows2_10hg4_176",vo="_rows3_10hg4_180",Io="_rows4_10hg4_184",_o="_rows5_10hg4_188",Eo="_rows6_10hg4_192",Mo="_rows7_10hg4_196",xo="_rows8_10hg4_200",To="_rows9_10hg4_204",So="_rows10_10hg4_208",Lo="_rows11_10hg4_212",Ao="_rows12_10hg4_216",Co="_rows13_10hg4_220",Ro="_rows14_10hg4_224",Po="_rows15_10hg4_228",Oo="_rows16_10hg4_232",Bo="_rows17_10hg4_236",$o="_rows18_10hg4_240",jo="_rows19_10hg4_244",qo="_rows20_10hg4_248",F={editor:co,hasToolbar:po,editorLabel:mo,editorWrapper:ho,toolbar:go,error:yo,caution:wo,rows1:bo,rows2:ko,rows3:vo,rows4:Io,rows5:_o,rows6:Eo,rows7:Mo,rows8:xo,rows9:To,rows10:So,rows11:Lo,rows12:Ao,rows13:Co,rows14:Ro,rows15:Po,rows16:Oo,rows17:Bo,rows18:$o,rows19:jo,rows20:qo},Lt=({id:e,onChange:t,defaultValue:n,labelText:r,"aria-labelledby":o,"aria-describedby":i,classNameOverride:s,controls:l,rows:a=3,dataError:u,onDataError:c,validationMessage:f,description:p,status:d="default",...g})=>{const b=E.useId(),[y]=E.useState(Ft(l)),m=e||b,w=o||`${m}-rte-label`,_=f?`${m}-rte-validation-message`:"",$=p?`${m}-rte-description`:"",j=pe(_,$,i),k=(()=>{try{return Vt(Nt.create({doc:Wt.fromJSON(y,{type:"doc",content:(n==null?void 0:n.length)>0?n:[{type:"paragraph"}]}),schema:y,plugins:zo(l,y)}),{"aria-labelledby":w,role:"textbox","aria-describedby":j})}catch{return new Error("Bad data error")}})();if(k instanceof Error)return c&&c(),h.createElement(cn,{headingProps:{children:"Error",variant:"heading-6"},type:"negative",persistent:!0},u||"Something went wrong");const[L,R,J]=k,At=ao(y,R,l);return E.useEffect(()=>{t(R)},[R]),h.createElement(h.Fragment,null,!o&&r&&h.createElement(Ot,{classNameOverride:F.editorLabel,id:w,labelText:r}),h.createElement("div",{className:pe(F.editorWrapper,F[d])},l&&h.createElement(Zt,{"aria-controls":m,"aria-label":"Text formatting",classNameOverride:F.toolbar},At.map((Ct,Rt)=>h.createElement(en,{key:Rt},Ct.map((K,Pt)=>h.createElement(tn,{key:Pt,icon:K.icon,disabled:K.disabled,label:K.label,isActive:K.isActive,onClick:()=>J(K.action)}))))),h.createElement("div",{id:m,ref:L,className:pe(F.editor,F[`rows${a}`],s,l!=null&&l.length>0&&F.hasToolbar),...g})),f&&h.createElement(je,{id:_,message:f,status:d}),p&&h.createElement(je,{id:$,message:p}))};Lt.displayName="RichTextEditor";function zo(e,t){const n=e?e.reduce((o,i)=>[...o,i.name],[]):[],r=[yt(),ze(fo(t)),ze(mt),uo(t)];return n.includes("link")&&r.push(eo({markType:t.marks.link})),r}Lt.__docgenInfo={description:`{@link https://cultureamp.atlassian.net/wiki/spaces/DesignSystem/pages/3081896752/Rich+Text+Editor Guidance} |
{@link https://cultureamp.design/?path=/docs/components-richtexteditor--docs Storybook}`,methods:[],displayName:"RichTextEditor",props:{id:{required:!1,tsType:{name:"string"},description:""},onChange:{required:!0,tsType:{name:"signature",type:"function",raw:"(content: ProseMirrorState.EditorState) => void",signature:{arguments:[{type:{name:"ProseMirrorState.EditorState"},name:"content"}],return:{name:"void"}}},description:""},defaultValue:{required:!0,tsType:{name:"Array",elements:[{name:"signature",type:"object",raw:"{ [key: string]: any }",signature:{properties:[{key:{name:"string"},value:{name:"any",required:!0}}]}}],raw:"Array<{ [key: string]: any }>"},description:""},controls:{required:!1,tsType:{name:"Array",elements:[{name:"signature",type:"object",raw:`{
  name: ToolbarControlTypes
  /**
   * A group is used to wrap items in the same section wrapper
   * ungrouped items will be appended to the end of the toolbar */
  group?: string
}`,signature:{properties:[{key:"name",value:{name:"union",raw:`| "bold"
| "italic"
| "underline"
| "orderedList"
| "bulletList"
| "link"`,elements:[{name:"literal",value:'"bold"'},{name:"literal",value:'"italic"'},{name:"literal",value:'"underline"'},{name:"literal",value:'"orderedList"'},{name:"literal",value:'"bulletList"'},{name:"literal",value:'"link"'}],required:!0}},{key:"group",value:{name:"string",required:!1},description:`A group is used to wrap items in the same section wrapper
ungrouped items will be appended to the end of the toolbar`}]}}],raw:"ToolbarItems[]"},description:""},rows:{required:!1,tsType:{name:"union",raw:`| 1
| 2
| 3
| 4
| 5
| 6
| 7
| 8
| 9
| 10
| 11
| 12
| 13
| 14
| 15
| 16
| 17
| 18
| 19
| 20`,elements:[{name:"literal",value:"1"},{name:"literal",value:"2"},{name:"literal",value:"3"},{name:"literal",value:"4"},{name:"literal",value:"5"},{name:"literal",value:"6"},{name:"literal",value:"7"},{name:"literal",value:"8"},{name:"literal",value:"9"},{name:"literal",value:"10"},{name:"literal",value:"11"},{name:"literal",value:"12"},{name:"literal",value:"13"},{name:"literal",value:"14"},{name:"literal",value:"15"},{name:"literal",value:"16"},{name:"literal",value:"17"},{name:"literal",value:"18"},{name:"literal",value:"19"},{name:"literal",value:"20"}]},description:`Sets a default min-height for the editable area in units of body paragraph line height, similar to the 'rows' attribute on <textarea>.
The editable area will autogrow, so this only affects the component when the content doesn't exceed this height.`,defaultValue:{value:"3",computed:!1}},dataError:{required:!1,tsType:{name:"ReactReactElement",raw:"React.ReactElement"},description:""},onDataError:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},status:{required:!1,tsType:{name:"union",raw:'"default" | "error" | "caution"',elements:[{name:"literal",value:'"default"'},{name:"literal",value:'"error"'},{name:"literal",value:'"caution"'}]},description:"",defaultValue:{value:'"default"',computed:!1}},validationMessage:{required:!1,tsType:{name:"ReactReactNode",raw:"React.ReactNode"},description:"A descriptive message for `error` or `caution` states"},description:{required:!1,tsType:{name:"ReactReactNode",raw:"React.ReactNode"},description:"A description that provides context"}}};export{Lt as R};
