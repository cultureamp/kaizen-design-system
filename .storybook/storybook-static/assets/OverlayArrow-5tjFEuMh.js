import{l as oe,c as Z}from"./focusSafely-ByiDPXQJ.js";import{b as le}from"./useOverlayTriggerState-B1dSu2Ro.js";import{r as H,R as re}from"./index-CTjT7uj6.js";import{$ as ne}from"./context-AGV5_Mtb.js";import{$ as ae,a as ie}from"./utils-e-dMXvly.js";function ce(){return typeof window.ResizeObserver<"u"}function G(t){const{ref:e,box:o,onResize:r}=t;H.useEffect(()=>{let l=e==null?void 0:e.current;if(l)if(ce()){const a=new window.ResizeObserver(i=>{i.length&&r()});return a.observe(l,{box:o}),()=>{l&&a.unobserve(l)}}else return window.addEventListener("resize",r,!1),()=>{window.removeEventListener("resize",r,!1)}},[r,e,o])}function j(t,e=-1/0,o=1/0){return Math.min(Math.max(t,e),o)}const N={top:"top",bottom:"top",left:"left",right:"left"},O={top:"bottom",bottom:"top",left:"right",right:"left"},se={top:"left",left:"top"},U={top:"height",left:"width"},D={width:"totalWidth",height:"totalHeight"},F={};let P=typeof document<"u"&&window.visualViewport;function q(t){let e=0,o=0,r=0,l=0,a=0,i=0,n={},d=(P==null?void 0:P.scale)>1;if(t.tagName==="BODY"){let g=document.documentElement;r=g.clientWidth,l=g.clientHeight;var c;e=(c=P==null?void 0:P.width)!==null&&c!==void 0?c:r;var p;o=(p=P==null?void 0:P.height)!==null&&p!==void 0?p:l,n.top=g.scrollTop||t.scrollTop,n.left=g.scrollLeft||t.scrollLeft,P&&(a=P.offsetTop,i=P.offsetLeft)}else({width:e,height:o,top:a,left:i}=k(t)),n.top=t.scrollTop,n.left=t.scrollLeft,r=e,l=o;return oe()&&(t.tagName==="BODY"||t.tagName==="HTML")&&d&&(n.top=0,n.left=0,a=P.pageTop,i=P.pageLeft),{width:e,height:o,totalWidth:r,totalHeight:l,scroll:n,top:a,left:i}}function fe(t){return{top:t.scrollTop,left:t.scrollLeft,width:t.scrollWidth,height:t.scrollHeight}}function J(t,e,o,r,l,a,i){let n=l.scroll[t],d=r[U[t]],c=r.scroll[N[t]]+a,p=d+r.scroll[N[t]]-a,g=e-n+i[t]-r[N[t]],w=e-n+o+i[t]-r[N[t]];return g<c?c-g:w>p?Math.max(p-w,c-g):0}function pe(t){let e=window.getComputedStyle(t);return{top:parseInt(e.marginTop,10)||0,bottom:parseInt(e.marginBottom,10)||0,left:parseInt(e.marginLeft,10)||0,right:parseInt(e.marginRight,10)||0}}function K(t){if(F[t])return F[t];let[e,o]=t.split(" "),r=N[e]||"right",l=se[r];N[o]||(o="center");let a=U[r],i=U[l];return F[t]={placement:e,crossPlacement:o,axis:r,crossAxis:l,size:a,crossSize:i},F[t]}function X(t,e,o,r,l,a,i,n,d,c){let{placement:p,crossPlacement:g,axis:w,crossAxis:s,size:x,crossSize:h}=r,f={};f[s]=t[s],g==="center"?f[s]+=(t[h]-o[h])/2:g!==s&&(f[s]+=t[h]-o[h]),f[s]+=a;const R=t[s]-o[h]+d+c,m=t[s]+t[h]-d-c;if(f[s]=j(f[s],R,m),p===w){const E=n?i[x]:e[D[x]];f[O[w]]=Math.floor(E-t[w]+l)}else f[w]=Math.floor(t[w]+t[x]+l);return f}function de(t,e,o,r,l,a,i,n){const d=r?o.height:e[D.height];let c=t.top!=null?o.top+t.top:o.top+(d-t.bottom-i),p=n!=="top"?Math.max(0,e.height+e.top+e.scroll.top-c-(l.top+l.bottom+a)):Math.max(0,c+i-(e.top+e.scroll.top)-(l.top+l.bottom+a));return Math.min(e.height-a*2,p)}function Q(t,e,o,r,l,a){let{placement:i,axis:n,size:d}=a;return i===n?Math.max(0,o[n]-t[n]-t.scroll[n]+e[n]-r[n]-r[O[n]]-l):Math.max(0,t[d]+t[n]+t.scroll[n]-e[n]-o[n]-o[d]-r[n]-r[O[n]]-l)}function me(t,e,o,r,l,a,i,n,d,c,p,g,w,s,x,h){let f=K(t),{size:R,crossAxis:m,crossSize:E,placement:M,crossPlacement:L}=f,u=X(e,n,o,f,p,g,c,w,x,h),A=p,I=Q(n,c,e,l,a+p,f);if(i&&r[R]>I){let Y=K(`${O[M]} ${L}`),te=X(e,n,o,Y,p,g,c,w,x,h);Q(n,c,e,l,a+p,Y)>I&&(f=Y,u=te,A=p)}let v="bottom";f.axis==="top"?f.placement==="top"?v="top":f.placement==="bottom"&&(v="bottom"):f.crossAxis==="top"&&(f.crossPlacement==="top"?v="bottom":f.crossPlacement==="bottom"&&(v="top"));let b=J(m,u[m],o[E],n,d,a,c);u[m]+=b;let C=de(u,n,c,w,l,a,o.height,v);s&&s<C&&(C=s),o.height=Math.min(o.height,C),u=X(e,n,o,f,A,g,c,w,x,h),b=J(m,u[m],o[E],n,d,a,c),u[m]+=b;let z={},S=e[m]+.5*e[E]-u[m];const T=x/2+h,y=o[E]-x/2-h,B=e[m]-u[m]+x/2,_=e[m]+e[E]-u[m]-x/2,ee=j(S,B,_);return z[m]=j(ee,T,y),{position:u,maxHeight:C,arrowOffsetLeft:z.left,arrowOffsetTop:z.top,placement:f.placement}}function ue(t){let{placement:e,targetNode:o,overlayNode:r,scrollNode:l,padding:a,shouldFlip:i,boundaryElement:n,offset:d,crossOffset:c,maxHeight:p,arrowSize:g=0,arrowBoundaryOffset:w=0}=t,s=r instanceof HTMLElement?$e(r):document.documentElement,x=s===document.documentElement;const h=window.getComputedStyle(s).position;let f=!!h&&h!=="static",R=x?k(o):V(o,s);if(!x){let{marginTop:I,marginLeft:v}=window.getComputedStyle(o);R.top+=parseInt(I,10)||0,R.left+=parseInt(v,10)||0}let m=k(r),E=pe(r);m.width+=E.left+E.right,m.height+=E.top+E.bottom;let M=fe(l),L=q(n),u=q(s),A=n.tagName==="BODY"?k(s):V(s,n);return s.tagName==="HTML"&&n.tagName==="BODY"&&(u.scroll.top=0,u.scroll.left=0),me(e,R,m,M,E,a,i,L,u,A,d,c,f,p,g,w)}function k(t){let{top:e,left:o,width:r,height:l}=t.getBoundingClientRect(),{scrollTop:a,scrollLeft:i,clientTop:n,clientLeft:d}=document.documentElement;return{top:e+a-n,left:o+i-d,width:r,height:l}}function V(t,e){let o=window.getComputedStyle(t),r;if(o.position==="fixed"){let{top:l,left:a,width:i,height:n}=t.getBoundingClientRect();r={top:l,left:a,width:i,height:n}}else{r=k(t);let l=k(e),a=window.getComputedStyle(e);l.top+=(parseInt(a.borderTopWidth,10)||0)-e.scrollTop,l.left+=(parseInt(a.borderLeftWidth,10)||0)-e.scrollLeft,r.top-=l.top,r.left-=l.left}return r.top-=parseInt(o.marginTop,10)||0,r.left-=parseInt(o.marginLeft,10)||0,r}function $e(t){let e=t.offsetParent;if(e&&e===document.body&&window.getComputedStyle(e).position==="static"&&!W(e)&&(e=document.documentElement),e==null)for(e=t.parentElement;e&&!W(e);)e=e.parentElement;return e||document.documentElement}function W(t){let e=window.getComputedStyle(t);return e.transform!=="none"||/transform|perspective/.test(e.willChange)||e.filter!=="none"||e.contain==="paint"||"backdropFilter"in e&&e.backdropFilter!=="none"||"WebkitBackdropFilter"in e&&e.WebkitBackdropFilter!=="none"}let $=typeof document<"u"&&window.visualViewport;function Ce(t){let{direction:e}=ne(),{arrowSize:o=0,targetRef:r,overlayRef:l,scrollRef:a=l,placement:i="bottom",containerPadding:n=12,shouldFlip:d=!0,boundaryElement:c=typeof document<"u"?document.body:null,offset:p=0,crossOffset:g=0,shouldUpdatePosition:w=!0,isOpen:s=!0,onClose:x,maxHeight:h,arrowBoundaryOffset:f=0}=t,[R,m]=H.useState({position:{},arrowOffsetLeft:void 0,arrowOffsetTop:void 0,maxHeight:void 0,placement:void 0}),E=[w,i,l.current,r.current,a.current,n,d,c,p,g,s,e,h,f,o],M=H.useRef($==null?void 0:$.scale);H.useEffect(()=>{s&&(M.current=$==null?void 0:$.scale)},[s]);let L=H.useCallback(()=>{if(w===!1||!s||!l.current||!r.current||!c||($==null?void 0:$.scale)!==M.current)return;let v=null;if(a.current&&a.current.contains(document.activeElement)){let T=document.activeElement.getBoundingClientRect(),y=a.current.getBoundingClientRect();v={type:"top",offset:T.top-y.top},v.offset>y.height/2&&(v.type="bottom",v.offset=T.bottom-y.bottom)}let b=l.current;if(!h&&l.current){var C;b.style.top="0px",b.style.bottom="";var z;b.style.maxHeight=((z=(C=window.visualViewport)===null||C===void 0?void 0:C.height)!==null&&z!==void 0?z:window.innerHeight)+"px"}let S=ue({placement:he(i,e),overlayNode:l.current,targetNode:r.current,scrollNode:a.current||l.current,padding:n,shouldFlip:d,boundaryElement:c,offset:p,crossOffset:g,maxHeight:h,arrowSize:o,arrowBoundaryOffset:f});if(b.style.top="",b.style.bottom="",b.style.left="",b.style.right="",Object.keys(S.position).forEach(T=>b.style[T]=S.position[T]+"px"),b.style.maxHeight=S.maxHeight!=null?S.maxHeight+"px":void 0,v){let T=document.activeElement.getBoundingClientRect(),y=a.current.getBoundingClientRect(),B=T[v.type]-y[v.type];a.current.scrollTop+=B-v.offset}m(S)},E);Z(L,E),ge(L),G({ref:l,onResize:L}),G({ref:r,onResize:L});let u=H.useRef(!1);Z(()=>{let v,b=()=>{u.current=!0,clearTimeout(v),v=setTimeout(()=>{u.current=!1},500),L()},C=()=>{u.current&&b()};return $==null||$.addEventListener("resize",b),$==null||$.addEventListener("scroll",C),()=>{$==null||$.removeEventListener("resize",b),$==null||$.removeEventListener("scroll",C)}},[L]);let A=H.useCallback(()=>{u.current||x()},[x,u]);le({triggerRef:r,isOpen:s,onClose:x&&A});var I;return{overlayProps:{style:{position:"absolute",zIndex:1e5,...R.position,maxHeight:(I=R.maxHeight)!==null&&I!==void 0?I:"100vh"}},placement:R.placement,arrowProps:{"aria-hidden":"true",role:"presentation",style:{left:R.arrowOffsetLeft,top:R.arrowOffsetTop}},updatePosition:L}}function ge(t){Z(()=>(window.addEventListener("resize",t,!1),()=>{window.removeEventListener("resize",t,!1)}),[t])}function he(t,e){return e==="rtl"?t.replace("start","right").replace("end","left"):t.replace("start","left").replace("end","right")}const ve=H.createContext({placement:"bottom"});function we(t,e){[t,e]=ae(t,e,ve);let o=t.placement,r={position:"absolute",[o]:"100%",transform:o==="top"||o==="bottom"?"translateX(-50%)":"translateY(-50%)"},l=ie({...t,defaultClassName:"react-aria-OverlayArrow",values:{placement:o}});return l.style&&Object.keys(l.style).forEach(a=>l.style[a]===void 0&&delete l.style[a]),re.createElement("div",{...t,...l,style:{...r,...l.style},ref:e,"data-placement":o})}const Te=H.forwardRef(we);export{Ce as $,ve as a,Te as b,G as c};
