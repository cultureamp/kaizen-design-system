import{a as E,b as P,h as w,m as T,l as R,n as L,d as _}from"./focusSafely-ByiDPXQJ.js";import{a as U,c as j}from"./usePress-nudZ2Xgz.js";import{$ as q}from"./useFocusWithin-C7oArVkD.js";import{$ as G}from"./useLabel-BoFVh7qz.js";import{$ as J,a as Q,b as X,c as Y,d as Z,e as ee}from"./SelectionManager-yuMfDyd5.js";import{R as O,r as g}from"./index-CTjT7uj6.js";import{$ as te}from"./useHover-Bq751pFs.js";const K=new WeakMap;function ie(e){return typeof e=="string"?e.replace(/\s*/g,""):""+e}function le(e,i){let l=K.get(e);if(!l)throw new Error("Unknown list");return`${l.id}-option-${ie(i)}`}function fe(e,i,l){let s=U(e,{labelable:!0}),r=e.selectionBehavior||"toggle",o=e.linkBehavior||(r==="replace"?"action":"override");r==="toggle"&&o==="action"&&(o="override");let{listProps:t}=J({...e,ref:l,selectionManager:i.selectionManager,collection:i.collection,disabledKeys:i.disabledKeys,linkBehavior:o}),{focusWithinProps:c}=q({onFocusWithin:e.onFocus,onBlurWithin:e.onBlur,onFocusWithinChange:e.onFocusChange}),n=E(e.id);K.set(i,{id:n,shouldUseVirtualFocus:e.shouldUseVirtualFocus,shouldSelectOnPressUp:e.shouldSelectOnPressUp,shouldFocusOnHover:e.shouldFocusOnHover,isVirtualized:e.isVirtualized,onAction:e.onAction,linkBehavior:o});let{labelProps:a,fieldProps:$}=G({...e,id:n,labelElementType:"span"});return{labelProps:a,listBoxProps:P(s,c,i.selectionManager.selectionMode==="multiple"?{"aria-multiselectable":"true"}:{},{role:"listbox",...P($,t)})}}function A(e){return null}A.getCollectionNode=function*(i,l){let{childItems:s,title:r,children:o}=i,t=i.title||i.children,c=i.textValue||(typeof t=="string"?t:"")||i["aria-label"]||"";!c&&!(l!=null&&l.suppressTextValueWarning)&&console.warn("<Item> with non-plain text contents is unsupported by type to select for accessibility. Please add a `textValue` prop."),yield{type:"item",props:i,rendered:t,textValue:c,"aria-label":i["aria-label"],hasChildNodes:oe(i),*childNodes(){if(s)for(let n of s)yield{type:"item",value:n};else if(r){let n=[];O.Children.forEach(o,a=>{n.push({type:"item",element:a})}),yield*n}}}};function oe(e){return e.hasChildItems!=null?e.hasChildItems:!!(e.childItems||e.title&&O.Children.count(e.children)>0)}let be=A;function he(e,i,l){var s,r;let{key:o}=e,t=K.get(i);var c;let n=(c=e.isDisabled)!==null&&c!==void 0?c:i.selectionManager.isDisabled(o);var a;let $=(a=e.isSelected)!==null&&a!==void 0?a:i.selectionManager.isSelected(o);var f;let x=(f=e.shouldSelectOnPressUp)!==null&&f!==void 0?f:t==null?void 0:t.shouldSelectOnPressUp;var u;let v=(u=e.shouldFocusOnHover)!==null&&u!==void 0?u:t==null?void 0:t.shouldFocusOnHover;var y;let b=(y=e.shouldUseVirtualFocus)!==null&&y!==void 0?y:t==null?void 0:t.shouldUseVirtualFocus;var h;let M=(h=e.isVirtualized)!==null&&h!==void 0?h:t==null?void 0:t.isVirtualized,k=w(),F=w(),p={role:"option","aria-disabled":n||void 0,"aria-selected":i.selectionManager.selectionMode!=="none"?$:void 0};T()&&R()||(p["aria-label"]=e["aria-label"],p["aria-labelledby"]=k,p["aria-describedby"]=F);let d=i.collection.getItem(o);if(M){let m=Number(d==null?void 0:d.index);p["aria-posinset"]=Number.isNaN(m)?void 0:m+1,p["aria-setsize"]=Q(i.collection)}let V=t!=null&&t.onAction?()=>{var m;return t==null||(m=t.onAction)===null||m===void 0?void 0:m.call(t,o)}:void 0,{itemProps:C,isPressed:B,isFocused:S,hasAction:z,allowsSelection:W}=X({selectionManager:i.selectionManager,key:o,ref:l,shouldSelectOnPressUp:x,allowsDifferentPressOrigin:x&&v,isVirtualized:M,shouldUseVirtualFocus:b,isDisabled:n,onAction:V||!(d==null||(s=d.props)===null||s===void 0)&&s.onAction?L(d==null||(r=d.props)===null||r===void 0?void 0:r.onAction,V):void 0,linkBehavior:t==null?void 0:t.linkBehavior}),{hoverProps:D}=te({isDisabled:n||!v,onHoverStart(){_()||(i.selectionManager.setFocused(!0),i.selectionManager.setFocusedKey(o))}}),I=U(d==null?void 0:d.props);delete I.id;let H=j(d==null?void 0:d.props);return{optionProps:{...p,...P(I,C,D,H),id:le(i,o)},labelProps:{id:k},descriptionProps:{id:F},isFocused:S,isFocusVisible:S&&_(),isSelected:$,isDisabled:n,isPressed:B,allowsSelection:W,hasAction:z}}class N{*[Symbol.iterator](){yield*this.iterable}get size(){return this.keyMap.size}getKeys(){return this.keyMap.keys()}getKeyBefore(i){let l=this.keyMap.get(i);return l?l.prevKey:null}getKeyAfter(i){let l=this.keyMap.get(i);return l?l.nextKey:null}getFirstKey(){return this.firstKey}getLastKey(){return this.lastKey}getItem(i){return this.keyMap.get(i)}at(i){const l=[...this.getKeys()];return this.getItem(l[i])}getChildren(i){let l=this.keyMap.get(i);return(l==null?void 0:l.childNodes)||[]}constructor(i){this.keyMap=new Map,this.iterable=i;let l=o=>{if(this.keyMap.set(o.key,o),o.childNodes&&o.type==="section")for(let t of o.childNodes)l(t)};for(let o of i)l(o);let s,r=0;for(let[o,t]of this.keyMap)s?(s.nextKey=o,t.prevKey=s.key):(this.firstKey=o,t.prevKey=void 0),t.type==="item"&&(t.index=r++),s=t,s.nextKey=void 0;this.lastKey=s==null?void 0:s.key}}function $e(e){let{filter:i}=e,l=Y(e),s=g.useMemo(()=>e.disabledKeys?new Set(e.disabledKeys):new Set,[e.disabledKeys]),r=g.useCallback(a=>i?new N(i(a)):new N(a),[i]),o=g.useMemo(()=>({suppressTextValueWarning:e.suppressTextValueWarning}),[e.suppressTextValueWarning]),t=Z(e,r,o),c=g.useMemo(()=>new ee(t,l),[t,l]);const n=g.useRef(null);return g.useEffect(()=>{if(l.focusedKey!=null&&!t.getItem(l.focusedKey)){const a=n.current.getItem(l.focusedKey),$=[...n.current.getKeys()].map(b=>{const h=n.current.getItem(b);return h.type==="item"?h:null}).filter(b=>b!==null),f=[...t.getKeys()].map(b=>{const h=t.getItem(b);return h.type==="item"?h:null}).filter(b=>b!==null),x=$.length-f.length;let u=Math.min(x>1?Math.max(a.index-x+1,0):a.index,f.length-1),v,y=!1;for(;u>=0;){if(!c.isDisabled(f[u].key)){v=f[u];break}u<f.length-1&&!y?u++:(y=!0,u>a.index&&(u=a.index),u--)}l.setFocusedKey(v?v.key:null)}n.current=t},[t,c,l,l.focusedKey]),{collection:t,disabledKeys:s,selectionManager:c}}export{$e as $,fe as a,he as b,be as c};
