import{f as b,c as R,g as T,h as S,b as U}from"./focusSafely-ByiDPXQJ.js";import{r as o}from"./index-CTjT7uj6.js";import{$ as _}from"./useLabel-BoFVh7qz.js";function K(a,e,t){let i=o.useRef(e),d=b(()=>{t&&t(i.current)});o.useEffect(()=>{var r;let n=a==null||(r=a.current)===null||r===void 0?void 0:r.form;return n==null||n.addEventListener("reset",d),()=>{n==null||n.removeEventListener("reset",d)}},[a,d])}function W(a,e,t){let{validationBehavior:i,focus:d}=a;R(()=>{if(i==="native"&&(t!=null&&t.current)){let l=e.realtimeValidation.isInvalid?e.realtimeValidation.validationErrors.join(" ")||"Invalid value.":"";t.current.setCustomValidity(l),t.current.hasAttribute("title")||(t.current.title=""),e.realtimeValidation.isInvalid||e.updateValidation(F(t.current))}});let r=b(()=>{e.resetValidation()}),n=b(l=>{var s;e.displayValidation.isInvalid||e.commitValidation();let u=t==null||(s=t.current)===null||s===void 0?void 0:s.form;if(!l.defaultPrevented&&t&&u&&Q(u)===t.current){var f;d?d():(f=t.current)===null||f===void 0||f.focus(),T("keyboard")}l.preventDefault()}),c=b(()=>{e.commitValidation()});o.useEffect(()=>{let l=t==null?void 0:t.current;if(!l)return;let s=l.form;return l.addEventListener("invalid",n),l.addEventListener("change",c),s==null||s.addEventListener("reset",r),()=>{l.removeEventListener("invalid",n),l.removeEventListener("change",c),s==null||s.removeEventListener("reset",r)}},[t,n,c,r,i])}function j(a){let e=a.validity;return{badInput:e.badInput,customError:e.customError,patternMismatch:e.patternMismatch,rangeOverflow:e.rangeOverflow,rangeUnderflow:e.rangeUnderflow,stepMismatch:e.stepMismatch,tooLong:e.tooLong,tooShort:e.tooShort,typeMismatch:e.typeMismatch,valueMissing:e.valueMissing,valid:e.valid}}function F(a){return{isInvalid:!a.validity.valid,validationDetails:j(a),validationErrors:a.validationMessage?[a.validationMessage]:[]}}function Q(a){for(let e=0;e<a.elements.length;e++){let t=a.elements[e];if(!t.validity.valid)return t}return null}const B={badInput:!1,customError:!1,patternMismatch:!1,rangeOverflow:!1,rangeUnderflow:!1,stepMismatch:!1,tooLong:!1,tooShort:!1,typeMismatch:!1,valueMissing:!1,valid:!0},C={...B,customError:!0,valid:!1},$={isInvalid:!1,validationDetails:B,validationErrors:[]},k=o.createContext({}),L="__formValidationState"+Date.now();function X(a){if(a[L]){let{realtimeValidation:e,displayValidation:t,updateValidation:i,resetValidation:d,commitValidation:r}=a[L];return{realtimeValidation:e,displayValidation:t,updateValidation:i,resetValidation:d,commitValidation:r}}return q(a)}function q(a){let{isInvalid:e,validationState:t,name:i,value:d,builtinValidation:r,validate:n,validationBehavior:c="aria"}=a;t&&(e||(e=t==="invalid"));let l=e!==void 0?{isInvalid:e,validationErrors:[],validationDetails:C}:null,s=o.useMemo(()=>D(N(n,d)),[n,d]);r!=null&&r.validationDetails.valid&&(r=null);let u=o.useContext(k),f=o.useMemo(()=>i?Array.isArray(i)?i.flatMap(v=>I(u[v])):I(u[i]):[],[u,i]),[P,A]=o.useState(u),[M,p]=o.useState(!1);u!==P&&(A(u),p(!1));let V=o.useMemo(()=>D(M?[]:f),[M,f]),x=o.useRef($),[E,g]=o.useState($),m=o.useRef($),w=()=>{if(!O)return;y(!1);let v=s||r||x.current;h(v,m.current)||(m.current=v,g(v))},[O,y]=o.useState(!1);return o.useEffect(w),{realtimeValidation:l||V||s||r||$,displayValidation:c==="native"?l||V||E:l||V||s||r||E,updateValidation(v){c==="aria"&&!h(E,v)?g(v):x.current=v},resetValidation(){let v=$;h(v,m.current)||(m.current=v,g(v)),c==="native"&&y(!1),p(!0)},commitValidation(){c==="native"&&y(!0),p(!0)}}}function I(a){return a?Array.isArray(a)?a:[a]:[]}function N(a,e){if(typeof a=="function"){let t=a(e);if(t&&typeof t!="boolean")return I(t)}return[]}function D(a){return a.length?{isInvalid:!0,validationErrors:a,validationDetails:C}:null}function h(a,e){return a===e?!0:a&&e&&a.isInvalid===e.isInvalid&&a.validationErrors.length===e.validationErrors.length&&a.validationErrors.every((t,i)=>t===e.validationErrors[i])&&Object.entries(a.validationDetails).every(([t,i])=>e.validationDetails[t]===i)}function Z(a){let{description:e,errorMessage:t,isInvalid:i,validationState:d}=a,{labelProps:r,fieldProps:n}=_(a),c=S([!!e,!!t,i,d]),l=S([!!e,!!t,i,d]);return n=U(n,{"aria-describedby":[c,l,a["aria-describedby"]].filter(Boolean).join(" ")||void 0}),{labelProps:r,fieldProps:n,descriptionProps:{id:c},errorMessageProps:{id:l}}}export{Z as $,K as a,W as b,X as c};
