#!/usr/bin/env bash
set -eo pipefail

extract-artifact() {
  buildkite-agent artifact download "$1" .
  tar -xf "$1"
}

main() {
  export KAIZEN_BASE_PATH=""
  if [[ $BUILDKITE_BRANCH != "master" ]]; then
    KAIZEN_BASE_PATH="/${BUILDKITE_BRANCH}"
  fi

  if [[ -n $KAIZEN_EXTRACT_ARTIFACTS ]]; then
    extract-artifact "site.tar.gz"
    extract-artifact "storybook.tar.gz"
  fi
}

main

unset -f main extract-artifact
