import { Canvas, Controls, DocsStory, Meta } from '@storybook/blocks'
import { ResourceLinks, KAIOInstallation, AlphaNotice } from '~storybook/components'
import * as SingleSelectStories from './SingleSelect.stories'

<Meta of={SingleSelectStories} />

# SingleSelect

<ResourceLinks
  sourceCode="https://github.com/cultureamp/kaizen-design-system/tree/main/packages/components/src/__alpha__/SingleSelect"
  figma=""
  designGuidelines=""
/>

<AlphaNotice />

<KAIOInstallation exportNames="SingleSelect" isAlpha />

## Overview

SingleSelect component that handles selecting items from a dropdown, can be either filterable or not.

<Canvas of={SingleSelectStories.Playground} />
<Controls of={SingleSelectStories.Playground} />

## API

Static list

- use when data is already available locally and won't change dynamically

```
<SingleSelect combobox label="Static colours" items={[
  { label: 'Red', value: 'red' },
  { label: 'Blue', value: 'blue' },
]} />
```

Async/remote data

- use when you want async fetching / server-side filtering / infinite scroll

```
<SingleSelect
  combobox
  label="Async colours"
  loadItems={async (query, page = 1) => {
    const filtered = allColors.filter(c =>
      c.label.toLowerCase().includes(query?.toLowerCase() ?? '')
    );
    return {
      items: filtered.slice((page - 1) * 7, page * 7),
      hasMore: page * 7 < filtered.length,
    };
  }}
/>
```

## Positioning and z-index Management

The SingleSelect component leverages the native Popover API to manage its dropdown functionality. By using popover instead of custom portal logic, the component takes full advantage of CSS layers, ensuring dropdowns appear above other content without manual z-index management.

## Known issues

### Accessibility

Using the default SingleSelect component without combobox, there is a known accessibility issue for keyboard navigation when the component is used as the last focusable element on the page. After the list is opened pressing Tab should close the list, instead Tab brings the user to a unqiue state where they cannot use the escape key to close the list. Instead the user will have to navigate either forward of back again using the Tab key.
