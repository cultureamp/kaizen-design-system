import { Canvas, Meta } from "@storybook/blocks"
import * as LegacyTagStories from "../../../../Tag/_docs/Tag.stories"
import * as TagMigrationStories from "./TagMigration.stories"

<Meta of={TagMigrationStories} />

# Tag migration guide

A brief guide on how and why to migrate from Kaizen's legacy `Tag` to the `future` release.

## Why the change?

Tag was rebuilt to allow for greater composability as the number of cases for a distinct Tags could not be solved through the use of `variant` without impacting the developer experience for existing users. The flexibility of `Tag` content as `children` also addresses several accessibility issues that the original could not solve intuitively.

## Component and API changes at a glance

There were a number key changes between legacy and the current `Tag` to achieve the flexibility we were aiming to provide, we've listed these below but also go into further detail in the [migration examples](/docs/components-tag-future-migration-guide--migrationguide#migration-examples).

- `variant` prop has been removed
  - This has been superseded by a combination of the `color` and `icon` prop
- `inline` prop and the default `margin` on all Tags has been removed.
  - This can be directly controlled through `classNameOverride` or a `flex-gap` on the container.
- `size` has been removed and all tags are the same size.
- `truncationWidth` has been removed as child content should be controlled by the consumer.
- `dismissable` prop has been removed.
  - A `DismissableTag` component is now available in its place.
- `Avatar` and all child content must now be composed by the consumer.
  - This offers a greater degree of flexibility to ensure that the right accessible context can be provided to the end user.


## Migration examples

The following are example of migrating from previously available props to the composable solution.

### Status

With the `variant` prop there are four values associated with statuses in the legacy tag:  `statusLive`, `statusDraft`, `statusClosed`, `statusAction`.

For the most part these can all be replaced easily with the use of the `color` prop, with exception to the `live` status.

#### Before

<Canvas of={LegacyTagStories.Status} />


#### After

<Canvas of={TagMigrationStories.StatusMigration} sourceState="shown"/>

While the `LiveIcon` is exported from `@kaizen/components` the legacy `Tag` used an animated implementation, which is not currently available. As an interim solution you can use the following story's code snippet to create a `LiveIconComponent`. This can then be passed into as `Children` of the `Tag`.

<Canvas of={TagMigrationStories.LiveIconComponentStory} sourceState="hidden"/>

### Validation

Following the same pattern as status, `validationPositive`, `validationInformative`, `validationNegative`, `validationCautionary` can all be replace with the `color` and `icon` prop.

Note: because the icons convey meaning, they should have an accessible label that provides context to the tag. A contextual `aria-label`and role of `img` addresses one of the [accessibility issues](https://github.com/cultureamp/kaizen-discourse/issues/102) with the legacy Tag.

#### Before

<Canvas of={LegacyTagStories.Validation} />

#### After

<Canvas of={TagMigrationStories.ValidationMigration} sourceState="shown"/>


Note: When using the `icon` prop, the icon's color will be determined by `color` value that has been set. This is to ensure that and accessible contrast ratio is achieved.

Any Icons added as a child of the `Tag` will need to be manually set to ensure the right contrast ratio.

### Sentiment

While migration of any `Tag` using, `sentimentPositive`, `sentimentNeutral` or `sentimentNegative` is relatively straight forward using the `color` prop, `sentimentNone` does not align to any Kaizen's [semantic colors](https://cultureamp.atlassian.net/wiki/spaces/DesignSystem/pages/3064857902/Color).

#### Before

<Canvas of={LegacyTagStories.Sentiments} />

#### After

<Canvas of={TagMigrationStories.SentimentsMigration} sourceState="shown"/>

If required, you could use `classNameOverride` to implement the same UI. It is important that any override of the default styles still meets minimum contrast ratios to ensure the component is accessible.

<Canvas of={TagMigrationStories.SentimentNone} />


### Dismissible

The `dismissible` prop is no longer available in the base `Tag` component. We have split the dismissible functionality into the [RemovableTag](/docs/components-tag-future-removabletag--docs).

This increases the hit box for the dismiss button and makes the `ariaLabel` in the `removeButtonProps` a required prop. This offers a more accessible experience for user and address one of the standing [accessibility issues](https://github.com/cultureamp/kaizen-discourse/issues/101) with the legacy `Tag`.

#### Before

<Canvas of={LegacyTagStories.Dismissible} />

#### After

<Canvas of={TagMigrationStories.DismissibleMigration} sourceState="shown"/>

Remember that when handling dismiss (or any destructive action), a users focus should not be lost on the page.


### Avatars

Avatars are no longer provided directly to the `Tag` as a prop. Instead they will now me passed in as children.

#### Before

<Canvas of={LegacyTagStories.ProfileWithAvatarProps} />

#### After

<Canvas of={TagMigrationStories.AvatarMigration} sourceState="shown"/>


Note: The use of `ps-4` (or `padding-inline-start`) in the `classNameOverride` is to override the default spacing at start of the `Tag`. This will ensure the Avatar can contour the border radius of the `Tag`.

#### Dismissible Avatars

Following a similar pattern to the above, you can use the `RemovableTag` with an `Avatar` and plain text as its children to achieve a dismissible version.

<Canvas of={TagMigrationStories.AvatarRemovableMigration} />

### Inline

Originally the `Tag` was built with the assumption that it would always required spacing at the end. This necessitated the need for the `inline` prop to remove the margin from end when it was not required.

In favour of simplifying the component, `inline` and the default `margin-inline-end` has been removed. It is recommended now to control spacing between tags to use a `gap` of 12 pixels on the container of the tags, ie: `gap-12`. In instances where more specific margins are require, opt for `margin-inline-end` and `classNameOverride` on the tag to ensure RTL support is baked in.

#### Before

<Canvas of={LegacyTagStories.Inline} />

#### After

<Canvas of={TagMigrationStories.InlineMigration} sourceState="shown"/>


### Truncation

This was original controlled by the component and set the `max-width` of a component via inline styles. This can now be easily controlled with Tailwind and was not needed in the new API.

#### Before

<Canvas of={LegacyTagStories.Truncate} />

#### After

<Canvas of={TagMigrationStories.TruncateMigration} sourceState="shown"/>

### Size

The two sizes for tag have been remove in favour of a default size in between `medium` and `small`. The `small` specifically was removed due to the reduced hit radius for the dismissible button and poor compatibility with avatars and icon.

`classNameOverride` can be leveraged to add padding and modify properties but should be done with caution to reduce inconsistencies in the platform and reduce the risk of accessibility violations/


#### Before

<Canvas of={LegacyTagStories.Sizes} />

#### After

<Canvas of={TagMigrationStories.SizesMigration} sourceState="shown"/>
