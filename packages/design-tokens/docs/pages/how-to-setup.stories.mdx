import { Meta } from '@storybook/addon-docs/blocks';
import { zenTheme, heartTheme } from '../../src/themes'
import { Card } from '@kaizen/draft-card'
import { Box } from "@kaizen/component-library";
import { makeCSSVariableTheme } from '../../src/utils'
import { ThemesCodeBlocks, SassVariablesCodeBlocks, CodeBlock, LinkToStory } from "../DocsComponents"
import LinkTo from '@storybook/addon-links/react'
import howToUseInSass from './how-to-use-with-sass.stories.mdx'
import howToUseInReact from './how-to-use-in-react.stories.mdx'
import howToSwitchThemes from './how-to-switch-themes.stories.mdx'

<Meta title="How-to guides/Getting started" parameters={{ docsOnly: true }} />

# Getting started

This document should serve as an explanation for how to use our design tokens - `@kaizen/design-tokens` - within your application, and the initial steps you need to take before using them in SASS or React.

## 1. Setup a ThemeManager

The first thing you need to do, per application, is instantiate a *singleton* `ThemeManager` class with the default theme as the initial theme, or another of your choice.
It is responsible for maintaining the state of the currently active theme, and applying themes to the DOM through CSS variables to make them accessible in SASS/LESS/CSS.

Example: 
<CodeBlock language="typescript" code={
`import { ThemeManager, defaultTheme } from '@kaizen/design-tokens'
export const themeManager = new ThemeManager(defaultTheme);`
} />

Design tokens are themable. You consume them with the assumption that they can change at runtime; you should **subscribe** to them rather than access them.

**Note**: it is important to be aware of the loading order of your application's assets. This code needs to be run *before* any parts of your UI (that depend on CSS variables being defined) are visible. See [Caveats](#caveats)

## 2. Start using design tokens

The recommended approaches to consuming design tokens current are to:

- Import their CSS variables representations in SASS - <LinkToStory storyModule={howToUseInSass} />
- In a React application, use context and hook components to subscribe and consume the current theme values - <LinkToStory storyModule={howToUseInReact} />

Alternatively, you may access the design tokens directly by using `themeManager.getCurrentTheme()`, or subscribing to the current theme using `themeManager.addThemeChangeListener(theme => ...)`

## 3. Switching themes

You may at some point want to change themes, for example based on user preferences or flags.

You can call `themeManager.setAndApplyTheme(themeObject)` to do this, which will set CSS variables accordingly and update all subscribers.

See <LinkToStory storyModule={howToSwitchThemes} /> for more details and complex examples.


## Caveats

Before a ThemeManager has been instantiated, no CSS variables will have been defined on the DOM automatically. 
This means that any parts of your UI that are loaded before the theme manager (for example HAML blocks) will render initially without CSS variables defined, which can be bad if no fallbacks are defined in your usages of CSS variables.

The framework accommodates for this in two ways:

- Every SASS variable that contains a CSS variable will provide a fallback value to the default theme. See [SASS Variables](#sass-variables).
- Allows you to import a theme-specific CSS file that defines variables on `:root`, which resides in `@kaizen/design-tokens/css/`. At the time of writing there are 3 files: `zen-theme.css`, `heart-theme.css` and `default-theme.css`, where the default theme is Zen and those two theme files will be identical.
    - For example, you could add a tag to your index.html file such as `<link rel="stylesheet" href="./node_modules/@kaizen/design-tokens/css/heart-theme.css">`
    - You could use CSS imports in a top level CSS file, like: `@import "~@kaizen/design-tokens/css/zen-theme.css"`
    - Or, if your build system supports it, add a JS import statement like `import "@kaizen/design-tokens/css/default-theme.css"`. However, if you are able to load CSS in this manner before all UI components, you can probably instantiate a ThemeManager too. 

A further caveat is that if you need to load a different theme based on user-preferences or feature flags, you will most likely need to use a ThemeManager to control which one is active, hence if the theme loaded initially doesn't match the one loaded by the ThemeManager, incorrect styles may initially flash.

